---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/15 19:28
---

local UIShowPropView = BaseClass("UIShowPropView",UIBaseView);
local base = UIBaseView;
local this = UIShowPropView;

local back_btn_path = "Button";
local item_prefab_path = "ItemPrefab";
local content_path = "Content";


local function InitContent(self)
    ListChildPool:GetInstance():ClearContent(self.content);
    coroutine.start(function()
        for k,v in table.pairsByKeys(self.model.item_list) do
            ListChildPool:GetInstance():GetChild("ItemPrefab", self.content,function(object)
                local transform = object.transform;
                local icon_image = transform:Find("Icon"):GetComponent("Image");
                local z_item = Z_Item[v.TemplateId];
                local name_text = transform:Find("Name"):GetComponent("Text");
                local num_text = transform:Find("Num"):GetComponent("Text");
                name_text.text = z_item.Name;
                num_text.text = v.Amount
                UIUtil.SetSprite(icon_image,AtlasConfig.Item,GetItemIcon(z_item));
                UIUtil.GetButtonDataComponent(object):Add("item",item);
                ButtonListener.Get(object).OnClickHandler = function()
                    if self.model.data.callBack ~= nil then
                        self.model.data.callBack(self.model.data.self, v)
                    end
                    self.ctrl:CloseSelf();
                end
                UIUtil.AddBtnSound(object);
            end);
        end
    end)
end

function this.OnCreate(self)
    base.OnCreate(self);
    self.back_btn = self.rc:GetObject(back_btn_path);
    self.item_prefab = self.rc:GetObject(item_prefab_path);
    self.content = self.rc:GetObject(content_path);
    ButtonListener.Get(self.back_btn).OnClickHandler = self.ctrl.CloseSelf;
    UIUtil.AddBtnSound(self.back_btn);
end

function this.OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
end

function this.OnRefresh(self)
    InitContent(self);
end

function this.OnAddListener(self)
    base.OnAddListener(self);
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self);
    ListChildPool:GetInstance():ClearContent(self.content);
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;