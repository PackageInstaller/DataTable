---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---

---@class UIFormatNewCtrl
---@field model UIFormatNewModel
local UIFormatNewCtrl = BaseClass("UIFormatNewCtrl",UIBaseCtrl);
local this = UIFormatNewCtrl

function this.CloseSelf(v)
    UIManager:GetInstance():CloseWindow(UIWindowNames.UIFormatNew);
end

---@param cardList {card:Card|nil, index:number, id:number}[] @ key: index
---@param fightSoulList {fightSoul:FightSoul|nil, index:number, id:number}[] @ key: index
function this:SendChangeTeamRequest(teamId, cardList, fightSoulList)
    ---@type protocol.FormationModifyReq
    local msg = {}
    msg.type = self.model.formationsType
    msg.formation = {}
    msg.formation.id = teamId
    msg.formation.id_list = {}
    local ids = {}
    for index, value in ipairs(cardList) do
        if value.id == nil or value.id == 0 then
            msg.formation.id_list[index] = 0
        else
            if ids[value.id] == nil then
                msg.formation.id_list[index] = value.id
                ids[value.id] = true
            end
        end
    end
    msg.formation.fight_soul_list = {}
    for index, value in ipairs(fightSoulList) do
        msg.formation.fight_soul_list[index] = value.id or 0
    end

    PublicRequest.SendRequest(PROTOCOL.FormationModifyReq, msg)
end

function this.OnConfirmClick(self, arg)
    if self.model.confirmCallBack ~= nil then
        self.model.confirmCallBack(arg)
    end
end

function this.OnAutoClick(self, arg)
    if self.model.autoCallBack ~= nil then
        self.model.autoCallBack(arg)
    end
end

return this

