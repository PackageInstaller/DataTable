---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---

local UIEquipInfoView = BaseClass("UIEquipInfoView",UIBaseView);
local base = UIBaseView
local this = UIEquipInfoView
local PropName = {"攻击力","防御力","体力"}    --ignoreCN


local function UnEquipCallBack()
    DataManager:GetInstance():Broadcast(DataMessageNames.ON_EQUIP_INFO_CHG)
    UIManager:GetInstance():CloseWindow(UIWindowNames.UIEquipInfo)
end

local function OnClickIntensButton(self)
    local data = {cur_equip = self.equip, panel_id = 3}
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIEquipIntens,data)
    self.ctrl:CloseSelf()
end

local function OnClickUnEquipButton(self)
    local sendData = {}
    local holder = UIPublic.GetEquipHolder(self.equip)
    local data = UIPublic.GetEquipEquipData(holder,self.equip,false);
    table.insert(sendData,data)
    PublicRequest.SendChangeEquipRequest(sendData,UnEquipCallBack)
end

local function OnClickReplaceButton(self)
    local holder = UIPublic.GetEquipHolder(self.equip)
    UIPublic.OpenChangeEquipWindow(holder)
    self.ctrl:CloseSelf()
end


local function InitEquipDetail(gameObject,equip)
    local transform = gameObject.transform
    local propTxt = transform:Find("Prop/Text"):GetComponent("Text")
    local appendTxt = transform:Find("Append/Text"):GetComponent("Text")
    local descTxt = transform:Find("Desc/Text"):GetComponent("Text")

    local zEquip = Z_Equip[equip.TemplateId]
    local props = equip:GetComponent("EquipAttrComponent"):GetAttrDescs();
    local str = "";
    for k, v in pairs(props) do
        str = str.. v .."\n"
    end
    propTxt.text =  str;
    appendTxt.text = LangUtil.GetSysLang(1043).. (zEquip.Exclusive ~= 0 and {zEquip.ExclusiveEfx} or {zEquip.AdditionEfx})[1]  --"附加效果:"
    descTxt.text = LangUtil.GetSysLang(1044)..zEquip.Desc --"描述:"
end

local function InitEquipInfo(self)
    self.name_Txt.text = self.zEquip.Name
    UIUtil.SetSprite(self.avatar,AtlasConfig.Equip,self.zEquip.EquipIcon,true)
    InitEquipDetail(self.detailContent,self.equip)
end



function this.OnCreate(self)
    base.OnCreate(self);
    self.detailContent = self.rc:GetObject("DetailContent")
    self.bg = self.rc:GetObject("Bg")
    self.intens_Btn = self.rc:GetObject("IntensButton")
    self.unEquip_Btn = self.rc:GetObject("UnEquipButton")
    self.replace_Btn = self.rc:GetObject("ReplaceButton")
    self.name_Txt = self.rc:GetObject("Name"):GetComponent("Text")
    self.avatar = self.rc:GetObject("Avatar"):GetComponent("Image")
    
    EventTriggerListener.Get(self.bg).onLuaClick = self.ctrl.CloseSelf
    ButtonListener.Get(self.intens_Btn).OnClickHandler = function(go) OnClickIntensButton(self) end
    ButtonListener.Get(self.unEquip_Btn).OnClickHandler = function(go) OnClickUnEquipButton(self) end
    ButtonListener.Get(self.replace_Btn).OnClickHandler = function(go) OnClickReplaceButton(self) end
    
end

function this.OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
end



function this.OnRefresh(self) 
    self.equip = self.model.equip
    self.zEquip = Z_Equip[self.equip.TemplateId]
    InitEquipInfo(self)
end

function this.OnAddListener(self)
    base.OnAddListener(self);
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self);
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;

