---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/2 14:40
---

local UIComoTopView = BaseClass("UIComoTopView",UIBaseView)
local base = UIBaseView

local IsUpData = true

local function InitComTop(self, windowName)
    local window = windowName
    if window == nil then
        window = "UIHome"
    end

    for i = 0, 3 do
        local itemObj = self.moneyCtrl.transform:GetChild(i)
        itemObj.gameObject:SetActive(false)
    end

    local itemList = Z_ComTop[window.__name]

    self.currentList = itemList

    for index, value in ipairs(itemList) do
        local itemObj = self.moneyCtrl.transform:GetChild(index - 1)
        itemObj.gameObject:SetActive(true)
        local img = itemObj.transform:Find("Image"):GetComponent("Image")
        UIUtil.SetSprite(img, AtlasConfig.Item, GetItemIcon(Z_Item[value.ObjId]))
        local txt = itemObj.transform:Find("Text"):GetComponent("Text")
        txt.text = UIPublic.GetItemAmount(value.ObjId)
        local plus = itemObj.transform:Find("Plus")
        if value.JumpName == "" then
            plus.gameObject:SetActive(false)
        else
            plus.gameObject:SetActive(true)
            UIUtil.AddBtnEvent(plus,function(go)
                if value.JumpName == "UIAllShop" then
                    UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllShop, {
                        ShopTitleType = value.JumpParam[1],
                        GeneralShopType = value.JumpParam[2]
                    })
                else
                    UIManager:GetInstance():OpenWindow(window.WindowName, { typeName = window.typeName })
                end
            end)
        end

        UIUtil.AddBtnEventNoBug(itemObj.transform,function(go)
            local showData = {}
            showData.showType = ShowType.Item
            showData.tempId = tonumber(value.ObjId)
            UIUtil.OpenThingsDetailWindow(showData)
        end)
    end
end

local function CustomizeComTop(self, itemList)
    for i = 0, 3 do
        local itemObj = self.moneyCtrl.transform:GetChild(i)
        itemObj.gameObject:SetActive(false)
    end

    self.currentList = itemList
    for index, value in ipairs(itemList) do
        local itemObj = self.moneyCtrl.transform:GetChild(index - 1)
        itemObj.gameObject:SetActive(true)
        local img = itemObj.transform:Find("Image"):GetComponent("Image")
        UIUtil.SetSprite(img, AtlasConfig.Item, GetItemIcon(Z_Item[tonumber(value.ObjId)]))
        local txt = itemObj.transform:Find("Text"):GetComponent("Text")
        txt.text = UIPublic.GetItemAmount(tonumber(value.ObjId))
        local plus = itemObj.transform:Find("Plus")
        if value.JumpName == nil or value.JumpName == "" then
            plus.gameObject:SetActive(false)
        else
            plus.gameObject:SetActive(true)
            UIUtil.AddBtnEvent(plus,function(go)
                if value.JumpName == "UIAllShop" then
                    UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllShop, {
                        ShopTitleType = value.JumpParam[1],
                        GeneralShopType = value.JumpParam[2]
                    })
                else
                    UIManager:GetInstance():OpenWindow(window.WindowName, { typeName = window.typeName })
                end
            end)
        end

        UIUtil.AddBtnEventNoBug(itemObj.transform,function(go)
            local showData = {}
            showData.showType = ShowType.Item
            showData.tempId = tonumber(value.ObjId)
            UIUtil.OpenThingsDetailWindow(showData)
        end)
    end
end

local function OnLangCreate(self)
    local root2 = self.langRc:GetObject("MoneyCtrl").transform

end

local function OnCreate(self)
    base.OnCreate(self)
    
    self.currentList = {}
    self.moneyCtrl = self.rc:GetObject("MoneyCtrl")
    local x = self.moneyCtrl:GetComponent("RectTransform").localPosition.x
    self.moneyCtrlX2 = x - 160
    self.moneyCtrlX1 = x

    self.rectTransform = self.gameObject:GetComponent("RectTransform")
    self.rectTransform.offsetMin = Vector2.zero
    self.rectTransform.offsetMax = Vector2.zero

end

local function OnEnable(self)
    base.OnEnable(self)

    self:OnRefresh()
end

--local function MoveComTop(self)
--    local rect = self.backGround:GetComponent("RectTransform")
--    rect.localPosition = Vector2.New(rect.localPosition.x,rect.localPosition.y+self.height)
--    DoTweenManager.DOAnchorPos3D(rect,self.position,0.5)
--end

local function OnRefresh(self)

end

local function FadeComTop(self,isShow)
    if not isShow then
        table.csenuObject(self.gameObject.transform,function(v)
            local component = v:GetComponent("Image") or v:GetComponent("Text")
            if component ~= nil then
                component:DOFade(0,0)
            end
        end)
    else
        table.csenuObject(self.gameObject.transform,function(v)
            local component = v:GetComponent("Image") or v:GetComponent("Text")
            if component ~= nil then
                component:DOFade(1,0.5)
            end
        end)
    end
end

local function OnLangTypeChg(self)
    OnLangCreate(self)
end

local function OnItemDataUpdate(self, updateIds, removeIds)
    --self:OnRefresh()
    self:CustomizeComTop(self.currentList)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(UIMessageNames.ON_ITEM_DATA_UPDATE, OnItemDataUpdate)
    self:AddUIListener(UIMessageNames.ON_LANG_TYPE_CHG, OnLangTypeChg)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    self:RemoveUIListener(UIMessageNames.ON_ITEM_DATA_UPDATE)
    self:RemoveUIListener(UIMessageNames.ON_LANG_TYPE_CHG)
end

local function OnDestroy(self)
    IsUpData = true
    base.OnDestroy(self)
end

local function SetCurrencyDetail(item, state, itemId)
    item:SetActive(state)
    if state then
        local img = item.transform:Find("Image"):GetComponent("Image")
        UIUtil.SetSprite(img, AtlasConfig.Item, GetItemIcon(Z_Item[tonumber(itemId.Value[1])]))
        local txt = item.transform:Find("Text"):GetComponent("Text")
        txt.text = UIPublic.GetItemAmount(itemId.Value[1])
    end
end

UIComoTopView.OnCreate = OnCreate
UIComoTopView.OnEnable = OnEnable
UIComoTopView.OnRefresh = OnRefresh
UIComoTopView.OnAddListener = OnAddListener
UIComoTopView.OnRemoveListener = OnRemoveListener
UIComoTopView.OnDestroy = OnDestroy
--UIComoTopView.MoveComTop = MoveComTop
UIComoTopView.OnLangCreate = OnLangCreate
UIComoTopView.SetCurrencyDetail = SetCurrencyDetail
UIComoTopView.InitComTop = InitComTop
UIComoTopView.CustomizeComTop = CustomizeComTop

return UIComoTopView