---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/7/2 10:20
---

local InfoLogic = {};
local this = InfoLogic;


local function InitNumerical(self,level)
    local transform = self.numerical
    local hpTxt = transform:Find("HP/Value"):GetComponent("Text")
    local atkTxt = transform:Find("ATK/Value"):GetComponent("Text")
    local speedTxt = transform:Find("SPEED/Value"):GetComponent("Text")
    local defTxt = transform:Find("DEF/Value"):GetComponent("Text")
    local mdText = transform:Find("MD/Value"):GetComponent("Text")
    
    local charaterGrowthInfo = Z_CharacterGrowth[self.zCard.Id]

    hpTxt.text = charaterGrowthInfo[level].Hp
    atkTxt.text = charaterGrowthInfo[level].Atk
    speedTxt.text = charaterGrowthInfo[level].Speed
    defTxt.text = charaterGrowthInfo[level].Def
    mdText.text = charaterGrowthInfo[level].MagicDef
end

local function InitKind(self)
    local transform = self.kind
    local zCard = Z_Character[self.zCard.Id] 
    
    local rareImg = transform:Find("Rare/Value"):GetComponent("Image") --.gameObject
    local formImg = transform:Find("From/Value"):GetComponent("Image")
    local kindImg = transform:Find("Kind/Value"):GetComponent("Image") --.gameObject
    --local atkKindImg = transform:Find("AtkKind/Value").gameObject
    local mainPropImg = transform:Find("MainProp/Value"):GetComponent("Image") --.gameObject
    --local subPropImg = transform:Find("SubProp/Value").gameObject
    
    --local rareImg = transform:Find("Info/Rare/Value"):GetComponent("Image")
    --local class = transform:Find("Info/Class/Value"):GetComponent("Image")
    rareImg.sprite = AtlasManager:GetInstance():CoLoadImageAsync("UI/Common/Raility/"..UIPublic.RareNames[zCard.Rarity]..".png")
    UIUtil.SetSprite(kindImg, AtlasConfig.Class, zCard.Class .. "_" .. zCard.Rarity .. ".png")
    UIPublic.InitSubProp(mainPropImg, zCard.Prop)

    --UIPublic.InitRare(rareImg,zCard)
    UIUtil.SetSprite(formImg,AtlasConfig.CardFrom, self.zCard.Sphere..".png")
    --UIPublic.InitAbiliType(kindImg,zCard)
    --UIPublic.InitAtkDistance(atkKindImg,zCard)
    --UIPublic.InitMainProp(mainPropImg,zCard)
    --UIPublic.InitSubProp(subPropImg,zCard)
end


local function InitWorker(self)
    local transform = self.worker
    local painterName = transform:Find("Painter/Value"):GetComponent("Text")
    local voiceActorName = transform:Find("VoiceActor/Value"):GetComponent("Text")
    painterName.text = self.zCard.PainterName
    voiceActorName.text = self.zCard.VoicerName
end

local function InitDesc(self)
    local transform = self.desc
    local descTxt = transform:Find("Value"):GetComponent("Text")
    descTxt.text = self.zCard.Archive
end

local function OnClickLevelButton(self,level)
    self.maxLvBtn.transform:Find("Active").gameObject:SetActive(level == 100)
    self.minLvBtn.transform:Find("Active").gameObject:SetActive(level == 1)
    --InitNumerical(self,level)
end

local function DOFade(self,bool)
    local value = (bool == true and {1} or {0})[1]
    table.csenuObject(self.infoRoot.transform,function(transform)
        if transform.gameObject.name ~= "VoiceActor" and transform.gameObject.name ~= "Painter" then
            local txt = transform:GetComponent("Text")
            local img = transform:GetComponent("Image")
            if not IsNull(txt) then
                txt:DOFade(value,0)
            end
            if not IsNull(img) then
                img:DOFade(value,0)
            end
        end
    end)
end


function this.Init(self)
    coroutine.start(function ()
        DOFade(self,false)
        OnClickLevelButton(self,1)
        self.infoRoot:SetActive(false)
        DOFade(self,false)
        InitKind(self)
        InitDesc(self)
        InitWorker(self)
        local oldPos = self.infoPanel.transform.localPosition
        self.infoPanel.transform.localPosition = Vector3.New(-9999, -9999, -9999)
        coroutine.waitforframes(2)
        self.infoRoot:SetActive(true)
        coroutine.waitforframes(2)
        self.infoPanel.transform.localPosition = oldPos
        LayoutRebuilder.ForceRebuildLayoutImmediate(self.infoRoot:GetComponent("RectTransform"))
        DOFade(self,true)
    end)
    self.infoRoot.transform:DOLocalMoveY(0,0)
end

function this.OnLangCreate(self,panel)
    local langRc = panel.transform:Find("LangControl"):GetComponent("ReferenceCollector")
    local desc = langRc:GetObject("Desc").transform
    local title2 = langRc:GetObject("Title2").transform
    local voiceActor = langRc:GetObject("VoiceActor").transform
    local title1 = langRc:GetObject("Title1").transform
    local title3 = langRc:GetObject("Title3").transform
    local kind = langRc:GetObject("Kind").transform
    local numerical = langRc:GetObject("Numerical").transform
    local painter = langRc:GetObject("Painter").transform
    
    LangUtil.BindText(desc)
    LangUtil.BindText(title1).text = LangUtil.GetSysLang(280)
    LangUtil.BindText(title2).text = LangUtil.GetSysLang(281)
    LangUtil.BindText(title3).text = LangUtil.GetSysLang(284)
    LangUtil.BindText(voiceActor:Find("Text")).text  = LangUtil.GetSysLang(282)
    LangUtil.BindText(voiceActor:Find("Value"))
    LangUtil.BindText(painter:Find("Text")).text  = LangUtil.GetSysLang(283)
    LangUtil.BindText(painter:Find("Value"))

    LangUtil.BindText(kind:Find("Rare/Text")).text = LangUtil.GetSysLang(166)
    LangUtil.BindText(kind:Find("From/Text")).text = LangUtil.GetSysLang(580)
    LangUtil.BindText(kind:Find("Kind/Text")).text = LangUtil.GetSysLang(168)
    LangUtil.BindText(kind:Find("AtkKind/Text")).text = LangUtil.GetSysLang(192)
    LangUtil.BindText(kind:Find("MainProp/Text")).text = LangUtil.GetSysLang(190)
    LangUtil.BindText(kind:Find("SubProp/Text")).text = LangUtil.GetSysLang(191)

    
    LangUtil.BindText(numerical:Find("HP")).text = LangUtil.GetSysLang(3036)
    LangUtil.BindText(numerical:Find("ATK")).text = LangUtil.GetSysLang(3038)
    LangUtil.BindText(numerical:Find("SPEED")).text = LangUtil.GetSysLang(3037)
    LangUtil.BindText(numerical:Find("DEF")).text = LangUtil.GetSysLang(3039)

    LangUtil.BindText(numerical:Find("HP/Value"),FontType.All_Number)
    LangUtil.BindText(numerical:Find("ATK/Value"),FontType.All_Number)
    LangUtil.BindText(numerical:Find("SPEED/Value"),FontType.All_Number)
    LangUtil.BindText(numerical:Find("DEF/Value"),FontType.All_Number)
    LangUtil.BindText(numerical:Find("MD/Value"),FontType.All_Number)
    LangUtil.BindText(self.maxLvBtn.transform:Find("Text"),FontType.All_Number)
    LangUtil.BindText(self.minLvBtn.transform:Find("Text"),FontType.All_Number)
    
end

function this.OnCreate(self,panel)
    self.infoPanel = panel
    local rc = panel:GetComponent("ReferenceCollector")
    self.numerical = rc:GetObject("Numerical").transform
    self.kind = rc:GetObject("Kind").transform
    self.desc = rc:GetObject("Desc").transform
    self.worker = rc:GetObject("Worker").transform
    self.infoRoot = rc:GetObject("Content")
    self.maxLvBtn = self.numerical:Find("MaxLv").gameObject
    self.minLvBtn = self.numerical:Find("MinLv").gameObject
    
    UIUtil.AddBtnEvent(self.maxLvBtn,function() OnClickLevelButton(self,100)  end)
    UIUtil.AddBtnEvent(self.minLvBtn,function() OnClickLevelButton(self,1)  end)
    
end

function this.OnEnable(self)

end

return InfoLogic;



