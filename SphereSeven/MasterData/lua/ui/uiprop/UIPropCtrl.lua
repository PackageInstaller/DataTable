---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---

local UIPropCtrl = BaseClass("UIPropCtrl",UIBaseCtrl);
local base = UIBaseCtrl
local this = UIPropCtrl

function this.CloseSelf(self)
    UIManager:GetInstance():CloseWindow(UIWindowNames.UIProp)
end

function this.SendUseRequest(self,templateId,amount)
    local items = Game.Scene.Player:GetComponent("ItemComponent").Items
    local item = table.first(items,function(v) return v.TemplateId == templateId  end)
    coroutine.start(function()
        local reqData={}
        reqData.items = {}
        table.insert(reqData.items, {
            uid = item.Id,
            count = amount,
            args = {}
        })
        local response =coroutine.yieldstart(Game.Scene.Session.CoCall,nil,Game.Scene.Session,
        PROTOCOL.UseItemReq,reqData)

        DataManager:GetInstance():Broadcast(DataMessageNames.ON_ITEM_INFO_CHG)
        if response.reward_result ~= nil then
            ---@type UIRewardParam
            local info = {}
            info.rewards = {}
            local hasRewards = false
            for key, value in pairs(response.reward_result) do
                hasRewards = true
                table.insert(info.rewards, {
                    RewardType = value.type,
                    templateId = value.id,
                    num = value.count,
                })
            end
            if hasRewards then
                UIManager:GetInstance():OpenWindow(UIWindowNames.UIReward, info)
            end
        end
    end)
end
return this;
