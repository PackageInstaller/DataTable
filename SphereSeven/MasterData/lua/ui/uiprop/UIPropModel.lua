---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---

---@class UIPropModel
---@field expendList table<number, Item> @ 消耗品列表 key: item Id, value: item数据
---@field matterList table<number, Item> @ 素材 (礼物和消耗品 以外的 item) key: item Id, value: item数据
local UIPropModel = BaseClass("UIPropModel",UIBaseModel);
local base = UIBaseModel
local this = UIPropModel

function this.OnCreate(self)
    base.OnCreate(self);
end

function this.OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
end

---@param self UIPropModel
function this.OnRefresh(self)
    local items = Game.Scene.Player:GetComponent("ItemComponent").Items
    self.expendList = table.choose(items, function(k,v) 
        if Z_Item[v.TemplateId] == nil or v.Amount <= 0 then
            return false
        else
            return Z_Item[v.TemplateId].Type == ItemType.ReasureBox
        end
    end)

    self.matterList = table.choose(items,function(k,v)
        if Z_Item[v.TemplateId] == nil or v.Amount <= 0 then
            return false
        else
            return Z_Item[v.TemplateId].Type == ItemType.Material
        end
    end)
    
    table.sort(self.expendList,function(a,b) return a.TemplateId > b.TemplateId  end)
    table.sort(self.matterList,function(a,b) return a.TemplateId > b.TemplateId  end)
end

local function OnItemInfoChg(self)
    self:OnRefresh()
    self:UIBroadcast(UIMessageNames.ON_ITEM_DATA_UPDATE)
end

--local function ON_Guide_Click(self,cid,num,isrun,minStep)
--    self:UIBroadcast(UIMessageNames.ON_Guide_Click,cid,num,isrun,minStep)
--end

local function OnFightsoulInfoChg(self) 
    self:UIBroadcast(UIMessageNames.ON_FIGHTSOUL_INFO_CHG)
end

---@param dataStatus {isUpdate:boolean, isRemove:boolean} @ isUpdate - 是否有更新, isRemove - 是否有删除
local function ON_EQUIP_UPDATE(self, dataStatus)
    self:UIBroadcast(UIMessageNames.ON_EQUIP_UPDATE, dataStatus)
end

function this.OnAddListener(self)
    base.OnAddListener(self);
    self:AddDataListener(DataMessageNames.ON_ITEM_DATA_UPDATE,OnItemInfoChg)
    self:AddDataListener(DataMessageNames.ON_FIGHTSOUL_INFO_CHG, OnFightsoulInfoChg)
    self:AddDataListener(DataMessageNames.ON_EQUIP_UPDATE, ON_EQUIP_UPDATE)

    --self:AddDataListener(DataMessageNames.ON_Guide_Click,ON_Guide_Click)
end


function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
    self:RemoveDataListener(DataMessageNames.ON_ITEM_DATA_UPDATE)
    self:RemoveDataListener(DataMessageNames.ON_FIGHTSOUL_INFO_CHG)
    self:RemoveDataListener(DataMessageNames.ON_EQUIP_UPDATE)

    --self:RemoveDataListener(DataMessageNames.ON_Guide_Click)
end

function this.OnDisable(self)
    base.OnDisable(self);
    
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;
