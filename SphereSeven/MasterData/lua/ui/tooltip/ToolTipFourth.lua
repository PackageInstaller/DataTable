---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/30 10:14
---

local ToolTipFourth = BaseClass("ToolTipFourth");
local this = ToolTipFourth;
local endIndex = Vector2.New(0, 200);
local starIndex = Vector2.New(0, -100);
local time = 1.5;
local prefab;
local parent;
local isActive = true

local function MoveEndCallBack(gameObject)
    ListChildPool:GetInstance():Remove(gameObject);
end

local function MoveGameObject(self)
    DoTweenManager.DOAnchorPos3D(self.rectTransform,endIndex,time, function()
        ListChildPool:GetInstance():Remove(self.gameObject)
        if self.callback then
            self.callback()
            self.callback = nil
        end
    end)

end


local function InitGameObject(self)
    self.rectTransform.localPosition = starIndex;
end

local function ActiveTip(self,message)
        ListChildPool:GetInstance():GetChild("ToolTipFourth",parent,function(object)
            self.gameObject = object;
            self.rectTransform = self.gameObject:GetComponent("RectTransform");
            self.transform = self.gameObject.transform;
            self.text = self.transform:Find("Text"):GetComponent("Text");
            if self.data and self.data.type == 2 then
                self.text.horizontalOverflow = 1
                self.text.verticalOverflow = 1
                self.text.resizeTextForBestFit = false
            else
                self.text.horizontalOverflow = 0
                self.text.verticalOverflow = 0
                self.text.resizeTextForBestFit = true
            end
            self.gameObject:GetComponent("Canvas").sortingOrder = 5400
            self.gameObject:GetComponent("Canvas").sortingLayerName = SortingLayerNames.UI
            LangUtil.BindText(self.text.transform)
            self.text.text = message
            InitGameObject(self);
            coroutine.waitforframes(1)
            MoveGameObject(self);
        end);
end

function this.__init(self,message, t, callback, data)
    time = t or 1.5
    self.callback = callback
    self.data = data
    if parent == nil then
        parent = CS.UnityEngine.GameObject.Find("TopLayer").gameObject;
    end
    if isActive then
        coroutine.start(function()
            if type(message) == "string" then
                ActiveTip(self,message)
            elseif type(message) == "table" then
                for i = 1, table.count(message) do
                    if not string.IsNullOrEmpty(message[i]) then
                        ActiveTip(self, message[i])
                        coroutine.waitforseconds(1)
                    end
                end
            end
            isActive = false
            coroutine.waitforseconds(1)
            isActive = true
        end)
    end
end

return this;