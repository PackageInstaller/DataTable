---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/12 17:40
---
local ToolTipFirstPlusView = BaseClass("ToolTipFirstPlusView",UIBaseView)
local base = UIBaseView
local this = ToolTipFirstPlusView

local function RefreshContent(self)
    local player = Game.Scene.Player
    if self.model.data.item == nil then
        self.num = 0
        local zItem = Z_Item[3001]
        self.BG.gameObject:SetActive(true)
        local AddNum = self.num * 50
        local str = string.gsub(LangUtil.GetSysLang(798),"XX",zItem.Name)
        str = string.gsub(str,"Y",self.num)
        self.type4Msg.text = LangUtil.GetSysLang(1096)--(player.Energy + AddNum  >= 9999 and {LangUtil.GetSysLang(1092)} or { str })[1]
        self.type4value.text = "<color=#" ..(player.Energy + AddNum < 9999 and{"40ee9a"} or{"f41f42"})[1] ..">"..player.Energy + AddNum .."</color>"..
                "/"..Z_PlayerLevelUp[player.Level].Energy..
                "<color=#fff2aa>".."  (+".. AddNum ..")".."</color>"
        if self.model.data.But2 then
            if player.Energy + AddNum <9999 then
                UIUtil.AddBtnEvent(self.type4But3,function()  self.ctrl:CloseSelf()  self.model.data.But2(self.num) end)
            else
                UIUtil.AddBtnEvent(self.type4But3,function()   end)
            end
        end
    else
        local zItem = Z_Item[self.model.data.item.TemplateId]
        if self.model.data.item.TemplateId == 3001 then
            self.BG.gameObject:SetActive(true)
            local AddNum = self.num * 50
            local str = string.gsub(LangUtil.GetSysLang(798),"XX",zItem.Name)
            str = string.gsub(str,"Y",self.num)
            self.type4Msg.text = (player.Energy + AddNum  >= 9999 and {LangUtil.GetSysLang(1092)} or { str })[1]
            self.type4value.text = "<color=#" ..(player.Energy + AddNum < 9999 and{"40ee9a"} or{"f41f42"})[1] ..">"..player.Energy + AddNum .."</color>"..
                    "/"..Z_PlayerLevelUp[player.Level].Energy..
                    "<color=#fff2aa>".."  (+".. AddNum ..")".."</color>"
            if self.model.data.But2 then
                if player.Energy + AddNum <9999 then
                    UIUtil.AddBtnEvent(self.type4But3,function()  self.ctrl:CloseSelf()  self.model.data.But2(self.num) end)
                else
                    UIUtil.AddBtnEvent(self.type4But3,function()   end)
                end
            end
        else
            local str = string.gsub(LangUtil.GetSysLang(798),"XX",zItem.Name)
            str = string.gsub(str,"Y",self.num)
            self.BG.gameObject:SetActive(false)
            self.type4Msg.text = str
            if self.model.data.But2 then
                UIUtil.AddBtnEvent(self.type4But3,function()  self.ctrl:CloseSelf()  self.model.data.But2(self.num) end)
            end
        end
    end
    if self.model.data.But1 then
        self.type4But2Text.text=LangUtil.GetSysLang(146)
        self.type4But2:SetActive(true)
        UIUtil.AddBtnEvent(self.type4But2,function() self.ctrl:CloseSelf() self.model.data.But1()  end)
    else
        self.type4But2Text.text=LangUtil.GetSysLang(146)
        self.type4But2:SetActive(true)
        UIUtil.AddBtnEvent(self.type4But2,function() self.ctrl:CloseSelf() end)
    end
    self.NumTxt.text = self.num
end

local function Type3Refresh(self)
    local player = Game.Scene.Player
    self.type3NumTxt.text = self.num
    self.APInfoText.text =  "<color=#" ..(player.Energy  >= self.model.data.Energy * self.num and{"fff2aa"} or {"F21837"})[1] ..">" ..self.model.data.Energy * self.num.. "</color>".. "/".. player.Energy
end

local function OnReduce(self)
    if self.model.data.type == 4 then
        if self.num <= 1 then
            UIUtil.ToolTipFourth(LangUtil.GetSysLang(565))
            return
        end
        self.num = self.num - 1
        RefreshContent(self)
    else
        if self.num <= 1 then
            UIUtil.ToolTipFourth(LangUtil.GetSysLang(565))
            return
        end
        self.num = self.num - 1
        Type3Refresh(self)
    end
end

local function OnAdd(self)
    local player = Game.Scene.Player
    if self.model.data.type == 4 then
        if self.model.data.item == nil or self.num >= self.model.data.item.Amount or self.num >= (self.maxNum or 20)  then
            UIUtil.ToolTipFourth(LangUtil.GetSysLang(566))
            return
        end
        self.num = self.num + 1
        RefreshContent(self)
    else
        if self.num >= self.model.data.Amount then
            UIUtil.ToolTipFourth(LangUtil.GetSysLang(4039))
            return
        elseif self.num >= (self.maxNum or 10) then
            UIUtil.ToolTipFourth(LangUtil.GetSysLang(4039))
            return
        elseif player.Energy  < self.model.data.Energy * (self.num+1) then 
            UIUtil.ToolTipFourth(LangUtil.GetSysLang(4039))
            return
        end
        self.num = self.num + 1
        Type3Refresh(self)
    end
end

local function OnMax(self)
    local player = Game.Scene.Player
    if self.model.data.type == 4 then
        if self.model.data.item ~=nil then
            self.num = (self.model.data.item.Amount>=20 and {20} or {self.model.data.item.Amount})[1]
            RefreshContent(self) 
        end
    else
        local maxEnergy = math.floor(player.Energy / self.model.data.Energy)
        local min = math.min(self.model.data.Amount, (self.maxNum or 10), maxEnergy)
        self.num = math.max(min, 1)
        Type3Refresh(self)
    end
end


function this.OnCreate(self)
    base.OnCreate(self);

    self.type1 =  self.rc:GetObject("type1")
    self.eventBg = self.rc:GetObject("eventBg");
    self.But1 = self.rc:GetObject("But1");
    self.But2 = self.rc:GetObject("But2");
    self.But3 = self.rc:GetObject("But3");
    self.CardNum = self.rc:GetObject("CardNum")
    self.FightSoulNum = self.rc:GetObject("FightSoulNum")

    self.type2 =  self.rc:GetObject("type2")
    self.type2Msg =  self.rc:GetObject("type2Msg"):GetComponent("Text")
    self.FreeStarStoneImage =  self.rc:GetObject("FreeStarStoneImage"):GetComponent("Image")
    self.FreeStarStoneValue =  self.rc:GetObject("FreeStarStoneValue"):GetComponent("Text")
    self.FreeStarStoneSelect =  self.rc:GetObject("FreeStarStoneSelect")
    self.PaidStarStoneSelect =  self.rc:GetObject("PaidStarStoneSelect")
    self.PaidStarStoneImage =  self.rc:GetObject("PaidStarStoneImage"):GetComponent("Image")
    self.PaidStarStoneValue =  self.rc:GetObject("PaidStarStoneValue"):GetComponent("Text")
    self.type2But2 =  self.rc:GetObject("type2But2")
    self.type2But3 =  self.rc:GetObject("type2But3")
   

    self.type3=self.rc:GetObject("type3")
    self.type3Msg =  self.rc:GetObject("type3Msg"):GetComponent("Text")
    self.type3But2 =  self.rc:GetObject("type3But2")
    self.type3But3 =  self.rc:GetObject("type3But3")
    self.ItemText =  self.rc:GetObject("ItemText")
    self.ItemValue =  self.rc:GetObject("ItemValue"):GetComponent("Text")
    self.ItemPrefab =  self.rc:GetObject("ItemPrefab")
    self.ItemTitle = self.rc:GetObject("ItemTitle")
    self.APInfo = self.rc:GetObject("APInfo")
    self.type3NumTxt =  self.rc:GetObject("Type3NumRoot").transform:Find("Image/NumTxt"):GetComponent("Text")
    self.type3ReduceButton =  self.rc:GetObject("Type3NumRoot").transform:Find("ReduceButton")
    self.type3AddButton =  self.rc:GetObject("Type3NumRoot").transform:Find("AddButton")
    self.type3MaxButton =  self.rc:GetObject("Type3NumRoot").transform:Find("MaxButton")

    self.type4=self.rc:GetObject("type4")
    self.type4Msg =  self.rc:GetObject("type4Msg"):GetComponent("Text")
    self.type4But2 =  self.rc:GetObject("type4But2")
    self.type4But3 =  self.rc:GetObject("type4But3")
    self.type4value =  self.rc:GetObject("type4value"):GetComponent("Text")
    self.NumTxt =  self.rc:GetObject("NumRoot").transform:Find("Image/NumTxt"):GetComponent("Text")
    self.ReduceButton =  self.rc:GetObject("NumRoot").transform:Find("ReduceButton")
    self.AddButton =  self.rc:GetObject("NumRoot").transform:Find("AddButton")
    self.MaxButton =  self.rc:GetObject("NumRoot").transform:Find("MaxButton")
    self.ItemPrefab1 =  self.rc:GetObject("ItemPrefab1")
    self.BG = self.rc:GetObject("BG")

    self.type6 = self.rc:GetObject("type6")
    self.type6Msg =  self.rc:GetObject("type6Msg"):GetComponent("Text")
    self.type6But1 =  self.rc:GetObject("type6But1")
    self.type6But2 =  self.rc:GetObject("type6But2")
    self.type6But3 =  self.rc:GetObject("type6But3")
    self.type6Item1 =  self.rc:GetObject("type6Item1")
    self.type6Item2 =  self.rc:GetObject("type6Item2")

    self.closeBut = self.rc:GetObject("CloseButton");
    UIUtil.AddBtnEvent(self.eventBg,function()  self.ctrl:CloseSelf() end)
    UIUtil.AddBtnEvent(self.closeBut,function()  self.ctrl:CloseSelf() end)
    
    UIUtil.AddBtnEvent(self.ReduceButton,function()  OnReduce(self) end)
    UIUtil.AddBtnEvent(self.AddButton,function()  OnAdd(self) end)
    UIUtil.AddBtnEvent(self.MaxButton,function()  OnMax(self) end)
    UIUtil.AddBtnEvent(self.type3ReduceButton,function()  OnReduce(self) end)
    UIUtil.AddBtnEvent(self.type3AddButton,function()  OnAdd(self) end)
    UIUtil.AddBtnEvent(self.type3MaxButton,function()  OnMax(self) end)
    --self.msg_text = LangUtil.BindText(self.rc:GetObject(msg_text_path))
    --self.title_text = LangUtil.BindText(self.rc:GetObject(title_text_path))
    
    --UIUtil.AddBtnEvent(self.back_btn,function() OnClickCancelButton(self) end)
    --UIUtil.AddBtnEvent(self.confirm_btn,function()OnClickConfirmButton(self) end)
end
function this.OnLangCreate(self)
    
    LangUtil.BindText(self.But3.transform:Find("Confirm"))
    LangUtil.BindText(self.But1.transform:Find("Text")).text = LangUtil.GetSysLang(556)
    LangUtil.BindText(self.But2.transform:Find("Text")).text = LangUtil.GetSysLang(258)
    LangUtil.BindText(self.CardNum.transform:Find("Text")).text = LangUtil.GetSysLang(411)
    LangUtil.BindText(self.CardNum.transform:Find("Value"),"Number")
    LangUtil.BindText(self.FightSoulNum.transform:Find("Text")).text = LangUtil.GetSysLang(412)
    LangUtil.BindText(self.FightSoulNum.transform:Find("Value"),"Number")
    LangUtil.BindText(self.type2Msg)
    LangUtil.BindText(self.type3Msg)
    LangUtil.BindText(self.rc:GetObject("PaidStarStoneText"))
    LangUtil.BindText(self.rc:GetObject("FreeStarStoneText"))
    LangUtil.BindText(self.PaidStarStoneValue,"Number")
    LangUtil.BindText(self.FreeStarStoneValue,"Number")
    LangUtil.BindText(self.type2But3.transform:Find("Confirm"))
    LangUtil.BindText(self.type2But2.transform:Find("Text"))
    LangUtil.BindText(self.ItemText)
    LangUtil.BindText(self.ItemValue,"Number")
    LangUtil.BindText(self.NumTxt,"Number")
    LangUtil.BindText(self.ItemTitle.transform:Find("Text")).text=LangUtil.GetSysLang(354)
    self.APInfoText = LangUtil.BindText( self.APInfo.transform:Find("Value"))
    LangUtil.BindText(self.type3NumTxt,FontType.All_Number)
           
    
    LangUtil.BindText(self.type3But3.transform:Find("Confirm"))
    LangUtil.BindText(self.type3But2.transform:Find("Text"))
    LangUtil.BindText(self.type4But3.transform:Find("Confirm"))
    self.type4But2Text = LangUtil.BindText(self.type4But2.transform:Find("Text"))
    LangUtil.BindText(self.type4Msg)
    LangUtil.BindText(self.type4value)
    LangUtil.BindText(self.type4value.transform.parent:Find("Text"))

    self.type6But1 = self.rc:GetObject("type6But1")
    self.type6But3 = self.rc:GetObject("type6But3")
    self.type6Item1 = self.rc:GetObject("type6Item1")
    self.type6Item2 = self.rc:GetObject("type6Item2")
    
    LangUtil.BindText(self.type6Msg)
    self.type6But1Text = LangUtil.BindText(self.type6But1.transform:GetChild(0))
    self.type6But2Text = LangUtil.BindText(self.type6But1.transform:GetChild(0))
    self.type6But3Text = LangUtil.BindText(self.type6But3.transform:GetChild(0))
    self.type6Item1Text = LangUtil.BindText(self.type6Item1.transform:Find("Text"))
    self.type6Item1Value = LangUtil.BindText(self.type6Item1.transform:Find("Value"))
    self.type6Item2Text = LangUtil.BindText(self.type6Item2.transform:Find("Text"))
    self.type6Item2Value = LangUtil.BindText(self.type6Item2.transform:Find("Value"))

    self.msg_text = LangUtil.BindText(self.rc:GetObject("Msg"))--:GetComponent("Text")
    self.title_text = LangUtil.BindText(self.rc:GetObject("TitleText"))--:GetComponent("Text")
end


function this.OnEnable(self)
    base.OnEnable(self);
    --ShowFirstTipTypeButton(self)
    self:OnRefresh();
end

local function ItemInfo(self,Item)

    local zItem = (Item==nil and {Z_Item[3001]} or {Z_Item[Item.TemplateId]})[1]
    local transform = self.ItemPrefab1.transform
    transform:Find("Name").gameObject:SetActive(false)
    local avatar = transform:Find("Icon"):GetComponent("Image")
    local name = transform:Find("Name/Value"):GetComponent("Text")
    local num = LangUtil.BindText(transform:Find("Num"))
    local itemBg = transform:Find("ItemBg"):GetComponent("Image")
    UIUtil.SetSprite(itemBg,AtlasConfig.ItemBg,"1.png",true)
    UIUtil.SetSprite(avatar,AtlasConfig.Item,GetItemIcon(zItem),true)
    --name.text = zItem.Name
    num.text = (Item == nil and {0} or {Item.Amount})[1]
end





function this.OnRefresh(self)
    local player = Game.Scene.Player
    self.num = 1
    self.maxNum = self.model.data.maxNum
    self.type1:SetActive(self.model.data.type ==1)
    self.type2:SetActive(self.model.data.type ==2 or self.model.data.type ==5)
    self.type3:SetActive(self.model.data.type ==3)
    self.type4:SetActive(self.model.data.type ==4)
    self.type6:SetActive(self.model.data.type ==6)
    self.title_text.text = self.model.data.title;
    if self.model.data.type == 1 then
        self.msg_text.text = self.model.data.message;
        self.CardNum.transform:Find("Value"):GetComponent("Text").text=self.model.data.cardNum.."/"..self.model.data.CardMax
        self.FightSoulNum.transform:Find("Value"):GetComponent("Text").text=self.model.data.FightSoulNum.."/"..self.model.data.FightSoulMax
        if self.model.data.But1  then
            self.But1:SetActive(true)
            UIUtil.AddBtnEvent(self.But1,function() self.ctrl:CloseSelf() self.model.data.But1()  end)
        end
        if self.model.data.But2 then
            self.But2:SetActive(true)
            UIUtil.AddBtnEvent(self.But2,function() self.ctrl:CloseSelf() self.model.data.But2()  end)
        else
            self.But2:SetActive(false)
        end
        if self.model.data.But3 then
            self.But3:SetActive(true)
            UIUtil.AddBtnEvent(self.But3,function() self.ctrl:CloseSelf() self.model.data.But3()  end)
        end
    elseif self.model.data.type == 2 then
        --self.FreeStarStoneSelect:SetActive(self.model.data.startType  == 1 )
        --self.PaidStarStoneSelect:SetActive(self.model.data.startType  == 2 )
        self.FreeStarStoneSelect.transform.parent.gameObject:SetActive(true )
        self.PaidStarStoneSelect.transform.parent.gameObject:SetActive(true )
        self.type2But2:SetActive(true)
        UIUtil.AddBtnEvent(self.type2But2,function() self.ctrl:CloseSelf() end)
        self.type2Msg.text = self.model.data.message;
        self.PaidStarStoneValue.text = (self.model.data.startType  == 2 and {"<color=#F21837>"} or {"<color=#FFFFFF>"})[1] .. UIUtil.ScientificCount(Game.Scene.Player.PaidStarStone) .."</color>"
        self.FreeStarStoneValue.text = ((self.model.data.startType  == 1 or self.model.data.startType  == 2) and {"<color=#F21837>"} or {"<color=#FFFFFF>"})[1] .. UIUtil.ScientificCount(Game.Scene.Player.FreeStarStone) .."</color>"
        UIUtil.SetSprite(self.FreeStarStoneImage, AtlasConfig.Item, GetItemIcon(Z_Item[ tonumber(Z_Misc["FREE_DIAMOND_ID"].Value[1]) ]))
        UIUtil.SetSprite(self.PaidStarStoneImage, AtlasConfig.Item, GetItemIcon(Z_Item[ tonumber(Z_Misc["DIAMOND_ID"].Value[1]) ]))
        if self.model.data.But2 then
            self.type2But3:SetActive(true)
            UIUtil.AddBtnEvent(self.type2But3,function()  self.ctrl:CloseSelf()  self.model.data.But2() end)
        end
    elseif self.model.data.type == 3 then
        --UIUtil.AddBtnEvent(self.type3But2,function() self.ctrl:CloseSelf() end)
        --self.APInfoText.text =  "<color=#" ..(player.Energy  >= self.model.data.Energy and{"fff2aa"} or {"F21837"})[1] ..">" ..player.Energy.. "</color>".. "/".. Z_PlayerLevelUp[player.Level].Energy
        self.type3Msg.text = self.model.data.message;
        local zItem = Z_Item[self.model.data.TemplateId]
        local transform = self.ItemPrefab.transform
        transform:Find("Name").gameObject:SetActive(false)
        local avatar = transform:Find("Icon"):GetComponent("Image")
        local name = transform:Find("Name/Value"):GetComponent("Text")
        local num = LangUtil.BindText(transform:Find("Num"))
        local itemBg = transform:Find("ItemBg"):GetComponent("Image")
        local itemIcon = self.ItemTitle.transform:Find("Icon"):GetComponent("Image")
        local itemNum = LangUtil.BindText(self.ItemTitle.transform:Find("Value"))
        
        UIUtil.SetSprite(itemBg,AtlasConfig.ItemBg,"1.png")
        UIUtil.SetSprite(avatar,AtlasConfig.Item,GetItemIcon(zItem))
        UIUtil.SetSprite(itemIcon,AtlasConfig.Item,GetItemIcon(zItem))
        name.text = zItem.Name
        
        itemNum.text = "<color=#"..(self.model.data.Amount > 0 and{"aad2ff"} or{"FF002A"})[1] .. ">" ..self.model.data.Amount .."</color>"
        num.gameObject:SetActive(false)
        --if self.model.data.notNum then
        --    num.gameObject:SetActive(false)
        --else
        --    num.text = self.model.data.ExpenseNum.."/".."<color=#"..(self.model.data.Amount >= self.model.data.ExpenseNum and{"40ee9a"} or{"f41f42"})[1] .. ">" ..self.model.data.Amount .."</color>"
        --end
        self.num = 1 --(self.model.data.Amount > 0 and{1} or{0})[1]
        if self.model.data.TemplateId == 3013 then
            Type3Refresh(self)
            self.APInfo.gameObject:SetActive(true)
            self.type3ReduceButton.parent.gameObject:SetActive(true)
        else
            self.APInfo.gameObject:SetActive(false)
            self.type3ReduceButton.transform.parent.gameObject:SetActive(false)
        end
        --Type3Refresh(self)
        if self.model.data.But1~=nil then
            self.type3But2:SetActive(true)
            UIUtil.AddBtnEvent(self.type3But2,function() self.ctrl:CloseSelf() self.model.data.But1()  end)
        else
            UIUtil.AddBtnEvent(self.type3But2,function() self.ctrl:CloseSelf() end)
        end
        if self.model.data.But2 then
            self.type3But3:SetActive(true)
            UIUtil.AddBtnEvent(self.type3But3,function()  self.ctrl:CloseSelf()  self.model.data.But2(self.num) end)
        end
    elseif self.model.data.type == 4 then
        
        ItemInfo(self,self.model.data.item)
        RefreshContent(self)
    elseif self.model.data.type == 5 then 
        local zItem = Z_Item[self.model.data.TemplateId]
        self.FreeStarStoneSelect.transform.parent.gameObject:SetActive(true )
        self.PaidStarStoneSelect.transform.parent.gameObject:SetActive(false )
        self.type2But2:SetActive(true)
        UIUtil.AddBtnEvent(self.type2But2,function() self.ctrl:CloseSelf() end)
        self.type2Msg.text = self.model.data.message;
        --self.PaidStarStoneValue.text = (self.model.data.startType  == 2 and {"<color=#F21837>"} or {"<color=#FFFFFF>"})[1] .. UIUtil.ScientificCount(Game.Scene.Player.PaidStarStone) .."</color>"
        self.FreeStarStoneValue.text = "1/".. ((self.model.data.startType  ~= 1 ) and {"<color=#F21837>"} or {"<color=#FFFFFF>"})[1] .. self.model.data.Amount .."</color>"
        UIUtil.SetSprite(self.FreeStarStoneImage,AtlasConfig.Item,GetItemIcon(zItem),true) --沙漏
        if self.model.data.But2 then
            self.type2But3:SetActive(true)
            UIUtil.AddBtnEvent(self.type2But3,function()  self.ctrl:CloseSelf()  self.model.data.But2() end)
        end
    elseif self.model.data.type == 6 then
        self.type6Msg.text = self.model.data.message;
        if self.model.data.Item1Value then
            self.type6Item1:SetActive(true)
            self.type6Item1Text.text = self.model.data.Item1Text
            self.type6Item1Value.text = self.model.data.Item1Value
        else
            self.type6Item1:SetActive(false)
        end
        if self.model.data.Item2Value then
            self.type6Item2:SetActive(true)
            self.type6Item2Text.text = self.model.data.Item2Text
            self.type6Item2Value.text = self.model.data.Item2Value
        else
            self.type6Item2:SetActive(false)
        end

        if self.model.data.But1  then
            self.type6But1:SetActive(true)
            self.type6But1Text.text = self.model.data.But1Text
            UIUtil.AddBtnEvent(self.type6But1,function() self.ctrl:CloseSelf() self.model.data.But1()  end)
        else
            self.But1:SetActive(false)
        end
        if self.model.data.But2 then
            self.type6But2:SetActive(true)
            self.type6But2Text.text = self.model.data.But2Text
            UIUtil.AddBtnEvent(self.type6But2,function() self.ctrl:CloseSelf() self.model.data.But2()  end)
        else
            self.type6But2:SetActive(false)
        end
        if self.model.data.But3 then
            self.type6But3:SetActive(true)
            self.type6But3Text.text = self.model.data.But3Text
            UIUtil.AddBtnEvent(self.type6But3,function() self.ctrl:CloseSelf() self.model.data.But3()  end)
        else
            self.type6But3Text.text = LangUtil.GetSysLang(146)--取消
            UIUtil.AddBtnEvent(self.type6But3,function() self.ctrl:CloseSelf()  end)
        end
    end
                
end

function this.OnAddListener(self)
    base.OnAddListener(self);
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self)
    self.But1:SetActive(false)
    self.But2:SetActive(false)
    self.But3:SetActive(false)
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this

