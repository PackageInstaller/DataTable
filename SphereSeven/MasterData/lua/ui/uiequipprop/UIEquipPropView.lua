---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---
---@class UIEquipPropView : UIBaseView
local UIEquipPropView = BaseClass("UIEquipPropView",UIBaseView);
local base = UIBaseView
local this = UIEquipPropView

local ItemTextColor = {
    [Rarity.R] = "B4A8C2",
    [Rarity.SR] = "CC68FF",
    [Rarity.SSR] = "E4A15B",
}

function this:InitEquipInfo()

    UIPublic.InitEquipItemNew(
        self.equipItem.transform,
    {
            Id = self.model.id,
            TemplateId = self.model.id,
            Level = nil,
            Lock = nil,
        },
        false,
        true
    )

    local propertyCount = 0
    local propertyList = UIPublic.GetEquipProperty(self.model.id, 1)
    for _, value in ipairs(PropertySort) do
        local propertyValue = propertyList[value.type]
        if propertyValue ~= nil then
            local zProperty = Z_Property[value.type]
            local sign = propertyValue > 0 and "+" or "-"
            if value.IsPct then
                propertyValue = propertyValue.. "%"
            end
            if propertyCount == 0 then
                propertyCount = propertyCount + 1
                self.prop1.text = LangUtil.GetSysLang(zProperty.SysLangKey) .. " " .. sign .. propertyValue
            else
                propertyCount = propertyCount + 1
                self.prop2.text = LangUtil.GetSysLang(zProperty.SysLangKey) .. " " .. sign .. propertyValue
            end
        end
    end

    if propertyCount == 1 then
        self.prop2.text = ""
    end
    -- self.prop1.text = propertyText

    local zEquip = self.zEquip

    self.nameTxt.text = zEquip.Name

    local classText = ""
    if zEquip.Exclusive ~= 0 then
        -- 专武
        local color = ItemTextColor[Z_Character[zEquip.Exclusive].Rarity]
        self.classTitle.text = LangUtil.GetSysLang(1453)--专武
        classText = string.gsub(LangUtil.GetSysLang(1454), "XXX", "<color=#" .. color .. ">" .. Z_Card[zEquip.Exclusive].Name .. "</color>")
    else
        self.classTitle.text = LangUtil.GetSysLang(1182)--职业
        if table.count(zEquip.Class) >= 6 then
            classText = LangUtil.GetSysLang(1380) -- 全职业通用
        else
            for index, class in ipairs(zEquip.Class) do
                classText = classText .. " " .. LangUtil.GetSysLang(SysLangKeys.ClassName[class])
            end
        end
    end

    
    self.class.text = classText
    self.part.text = self.partNames[zEquip.Part]

    local equipEffectText =UIPublic.GetEquipEffectText(self.model.id, 1)
    if string.IsNullOrEmpty(equipEffectText) then
        self.desc.text = LangUtil.GetSysLang(911)
    else
        self.desc.text = equipEffectText
    end
    self.desc1.text = zEquip.Desc

    UIPublic.InitEncyclopediaDetail(
        self.collection,
        self.model.id,
        RecordType.Equip
    )

    -- self.mask:SetActive(not Game.Scene.Player:GetComponent("RecordComponent"):CheckIsOn(RecordType.Equip, self.model.id))

    coroutine.start(function()
        coroutine.waitforframes(5)
        CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.rc:GetObject("Main"):GetComponent("RectTransform"))

    end)
end


function this:OnCreate()
    base.OnCreate(self)
    local eventBg = self.rc:GetObject("EventBg")
    EventTriggerListener.Get(eventBg).onLuaClick = function()
        UIManager:GetInstance():CloseWindow(UIWindowNames.UIEquipProp)
    end
    self.textScroll1 = self.rc:GetObject("TextScroll1")

    self.equipItem = self.rc:GetObject("EquipItemNew").transform

    self.collection = self.rc:GetObject("Collection").transform
end

function this:OnLangCreate()
    self.desc = LangUtil.BindText(self.rc:GetObject("Desc"))
    LangUtil.BindText(self.rc:GetObject("AttrText")).text = LangUtil.GetSysLang(912)
    self.desc1 = LangUtil.BindText(self.rc:GetObject("Desc1"))
    self.prop1 = LangUtil.BindText(self.rc:GetObject("Prop").transform:Find("Value1"))
    self.prop2 = LangUtil.BindText(self.rc:GetObject("Prop").transform:Find("Value2"))
    -- self.target = LangUtil.BindText(self.rc:GetObject("Target").transform:Find("Value"))
    self.class = LangUtil.BindText(self.rc:GetObject("Type").transform:Find("Value"))
    self.part = LangUtil.BindText(self.rc:GetObject("Part").transform:Find("Value"))
    -- self.department = LangUtil.BindText(self.rc:GetObject("Department").transform:Find("Value"))
    -- self.kind = LangUtil.BindText(self.rc:GetObject("Kind").transform:Find("Value"))

    LangUtil.BindText(self.rc:GetObject("Prop").transform:Find("Name").transform).text = LangUtil.GetSysLang(683)--基础属性
    -- LangUtil.BindText(self.rc:GetObject("Target").transform:Find("Name").transform).text = LangUtil.GetSysLang(682)--限制
    self.classTitle = LangUtil.BindText(self.rc:GetObject("Type").transform:Find("Name").transform)
    LangUtil.BindText(self.rc:GetObject("Part").transform:Find("Name").transform).text = LangUtil.GetSysLang(680)--部位
    -- LangUtil.BindText(self.rc:GetObject("Department").transform:Find("Name").transform).text = LangUtil.GetSysLang(679)--类别
    -- LangUtil.BindText(self.rc:GetObject("Kind").transform:Find("Name").transform).text = LangUtil.GetSysLang(678)--种类
    -- LangUtil.BindText(self.rc:GetObject("Level").transform:Find("Name").transform).text = LangUtil.GetSysLang(751)
    self.nameTxt = LangUtil.BindText(self.rc:GetObject("EquipName"))

    LangUtil.BindText(self.rc:GetObject("CollectionText")).text = LangUtil.GetSysLang(1183)--收集奖励
end


function this:OnEnable()
    base.OnEnable(self);
    self.zEquip = Z_Equip[self.model.info.TemplateId]
    self.targetNames = {LangUtil.GetSysLang(175),LangUtil.GetSysLang(176),LangUtil.GetSysLang(675),}
    self.baseAttrTypeNames = {"HP","ATK","DEF","SPD","HP%","ATK%","DEF%","SPD%"}
    self.atkRangeNames = {LangUtil.GetSysLang(185),LangUtil.GetSysLang(186),LangUtil.GetSysLang(675)}
    self.partNames = {LangUtil.GetSysLang(243),LangUtil.GetSysLang(244),LangUtil.GetSysLang(245),LangUtil.GetSysLang(246),
                      LangUtil.GetSysLang(247),LangUtil.GetSysLang(248),}
    self.kindNames = {LangUtil.GetSysLang(676),LangUtil.GetSysLang(677),LangUtil.GetSysLang(248)}

    self.departmentData = {}
    for i = 753,786 do
        table.insert(self.departmentData,LangUtil.GetSysLang(i))
    end

    self:InitEquipInfo()
end

function this.OnRefresh(self)

end


function this.OnAddListener(self)
    base.OnAddListener(self)
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self);
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;

