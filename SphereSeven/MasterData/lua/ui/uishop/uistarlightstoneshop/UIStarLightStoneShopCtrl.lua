---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by wwj.
--- DateTime: 2021/8/19 15:55
---

local UIStarLightStoneShopCtrl = BaseClass("UIStarLightStoneShopCtrl",UIBaseCtrl)
local this = UIStarLightStoneShopCtrl

function this.CloseSelf()
    UIManager:GetInstance():CloseWindow(UIWindowNames.UIStarLightStoneShop);
end

function this.SendStarLightRequest(self,data)
    local reqTable = {
        goods_id = data.Id
    }
    coroutine.start(function()
        local info = coroutine.yieldstart(Game.Scene.Session.CoCall,nil,Game.Scene.Session,
            PROTOCOL.BuyPaymentGoodsReq, reqTable)

        if info ~= nil then
            UIPublic.OpenRewardUI(info.reward_result)
        end
        end)
    -- coroutine.start(function()
    --     local player = Game.Scene.Player;
    --     local record = player:GetComponent("StarLightRebateComponent").PurchasesDetail
        
    --     local purchaseData = table.first(record,function(v)
    --         return v.Key == data.Id
    --     end)
    --     if purchaseData == nil then
    --         purchaseData = {Key = data.Id, Val = 0}
    --         table.insert(record, purchaseData)
    --     end
    --     local num = (purchaseData.Val == 0 and {3} or {1})[1]

    --     if data.Type ~=1 and purchaseData.Val ~= 0 then
    --         UIUtil.ToolTipFourth(LangUtil.GetSysLang(1064));
    --         return
    --     end

    --     local g2c = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
    --             OuterOpcode.Name2Code.ETModel_C2G_StarShop, {Id=data.Id})
    --     if g2c.Error == ErrorCode.ERR_Success then
    --         purchaseData.Val = 1 +  purchaseData.Val
    --         if data.Type ==1  then
    --             player.PaidStarStone =  player.PaidStarStone + data.CurrencyAmount[1] *num
    --             print("--获得星光石"..data.CurrencyAmount[1] * num)
    --         else
    --             for i = 1, table.count(data.CurrencyType) do
    --                 if data.CurrencyType[i] == 2then
    --                     player.PaidStarStone =  player.PaidStarStone + data.CurrencyAmount[i]
    --                     print("--获得星光石"..data.CurrencyAmount[i])
    --                 elseif data.CurrencyType[i] == 5then
    --                     player.MagicCrystal =  player.MagicCrystal + data.CurrencyAmount[i]
    --                     print("--获得魔晶"..data.CurrencyAmount[i])
    --                 end
    --             end
    --             --添加Item
    --             --if table.count(data.GoodsId) > 0 then
    --             --    for i = 1, table.count(data.GoodsId ) do
    --             --        local ItemBean = {}
    --             --        ItemBean.TemplateId = data.GoodsId[i]
    --             --        ItemBean.ItemId = data.GoodsId[i] -- 服务器返回的所以
    --             --        ItemBean.Amount = data.ItemAmount[i]
    --             --        UIPublic.AddItem(ItemBean);
    --             --    end
    --             --    --UIPublic.AddItem(g2cStorePurchase.ItemBean);
    --             --    DataManager:GetInstance():Broadcast(DataMessageNames.ON_ITEM_INFO_CHG);
    --             --    UIUtil.ToolTipFourth(LangUtil.GetSysLang(1081)) --购买成功
    --             --end
    --         end
    --         DataManager:GetInstance():Broadcast(DataMessageNames.ON_PLAYER_INFO_CHG);
    --         DataManager:GetInstance():Broadcast(DataMessageNames.ON_STAR_LIGHT_INFO_CHG);
    --         UIUtil.ToolTipFourth(LangUtil.GetSysLang(1081));--"够买成功"

    --     else
    --         UIUtil.ToolTipFourth(LangUtil.GetServerError(g2c.Error));
    --     end
    -- end)
end


return this