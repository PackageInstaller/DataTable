---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/12 19:56
---

---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/12 19:55
---
local UIShopView = BaseClass("UIShopView",UIBaseView)
local base = UIBaseView
local this = UIShopView


function this.OnCreate(self)
    base.OnCreate(self);
    self.back = self.rc:GetObject("BackButton")
    --LangUtil.BindText(self.back.transform:Find("Text"))
    self.giftType = 0
    
    self.monthCard = self.rc:GetObject("MonthCard")
    self.propEquip = self.rc:GetObject("PropEquip")
    self.skin = self.rc:GetObject("Skin")
    self.starStone = self.rc:GetObject("StarStone")
    self.npIcon = self.rc:GetObject("NpcIcon"):GetComponent("Image")
    
    self.face = UILandlady.New(self.npIcon, 1001, self.rc:GetObject("Lines"))
    --UIPublic.SetPainting(Z_Card[1027], self.npIcon)
    self.giftBut30 = self.rc:GetObject("GiftBut30")
    self.giftBut7 = self.rc:GetObject("GiftBut7")
    self.giftBut3 = self.rc:GetObject("GiftBut3")
    self.giftBut30S = self.rc:GetObject("GiftBut30").transform:Find("select")
    self.giftBut7S = self.rc:GetObject("GiftBut7").transform:Find("select")
    self.giftBut3S = self.rc:GetObject("GiftBut3").transform:Find("select")
    --if CS.GameChannel.ChannelManager.instance.packageName == ChannelType.Test  then
        self.giftBut30:SetActive(true)
        self.giftBut7:SetActive(true)
        self.giftBut3:SetActive(true)
    --else
    --    self.giftBut30:SetActive(false)
    --    self.giftBut7:SetActive(false)
    --    self.giftBut3:SetActive(false)
    --end
    
    
    UIUtil.AddBtnEvent(self.back,function() UIManager:GetInstance():CloseWindow(UIWindowNames.UIShop)  end,"Back")
    UIUtil.AddBtnEvent(self.monthCard,function()
        self.face:Stop()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIMonthCardShop,{Type = self.giftType})
        --UIUtil.ToolTipFourth(LangUtil.GetSysLang(861)) --充值功能暂未开放
    end)
    UIUtil.AddBtnEvent(self.propEquip,function()
        self.face:Stop()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIGeneralShop, {type = 1})
    end)
    UIUtil.AddBtnEvent(self.skin,function()
        self.face:Stop()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UISkinShop,{type = 1})
    end)
    UIUtil.AddBtnEvent(self.starStone,function()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIStarLightStoneShop, {face = self.face, type = 1})
        --UIUtil.ToolTipFourth(LangUtil.GetSysLang(861)) --充值功能暂未开放
    end)
    
    UIUtil.AddBtnEvent(self.giftBut30,function ()
        self.giftType = 0
        self.isClick = true
    end)
    UIUtil.AddBtnEvent(self.giftBut7,function ()
        self.giftType = 1
        self.isClick = true
    end)
    UIUtil.AddBtnEvent(self.giftBut3,function ()
        self.giftType = 2
        self.isClick = true
    end)
end

function this.OnLangCreate (self)
    
    LangUtil.BindText(self.back.transform:Find("Text"))
    
    LangUtil.GetSpriteLang(152, function(sprite) self.propEquip:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(153, function(sprite) self.skin:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(154, function(sprite) self.starStone:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(335, function(sprite) self.monthCard:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(338, function(sprite) self.giftBut30:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(339, function(sprite) self.giftBut7:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(340, function(sprite) self.giftBut3:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(341, function(sprite) self.giftBut30S:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(342, function(sprite) self.giftBut7S:GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(343, function(sprite) self.giftBut3S:GetComponent("Image").sprite = sprite end)
end

function this.OnEnable(self)
    base.OnEnable(self);
    coroutine.start(function()
        self.face:CoPlay()
        
        --Game.Scene:GetComponent("BgmComponent"):CoPlay(BgmType.UI,"Store")
    end)
    self:OnRefresh();
end

function this.OnRefresh(self)
    self.isClick = false
    self.time = 3
    self.count = 0
    self.giftBut30S.gameObject:SetActive(self.giftType == 0 )
    self.giftBut7S.gameObject:SetActive(self.giftType == 1)
    self.giftBut3S.gameObject:SetActive(self.giftType == 2)
    self.monthCard.transform:Find("30_Effect").gameObject:SetActive(self.giftType == 0)
    self.monthCard.transform:Find("7_Effect").gameObject:SetActive(self.giftType == 1)
    self.monthCard.transform:Find("3_Effect").gameObject:SetActive(self.giftType == 2)
    table.csenu(self.monthCard:GetComponentsInChildren(typeof(CS.UnityEngine.ParticleSystemRenderer),true),function (smr)
        smr.sortingOrder = self.canvas.unity_canvas.sortingOrder + 1
    end)
end

function this.Update(self)
    self.time = self.time - Time.deltaTime
    if self.time <=0  then
        self.time = 3
        self.giftType = self.count
        LangUtil.GetSpriteLang(335 + self.giftType , function(sprite) self.monthCard:GetComponent("Image").sprite = sprite end)
       
        self.giftBut30S.gameObject:SetActive(self.giftType == 0 )
        self.giftBut7S.gameObject:SetActive(self.giftType == 1)
        self.giftBut3S.gameObject:SetActive(self.giftType == 2)
        self.monthCard.transform:Find("30_Effect").gameObject:SetActive(self.giftType == 0)
        self.monthCard.transform:Find("7_Effect").gameObject:SetActive(self.giftType == 1)
        self.monthCard.transform:Find("3_Effect").gameObject:SetActive(self.giftType == 2)
        self.count = (self.count +1)%3
    end
    if self.isClick then
        self.time = 3
        self.isClick = false
        self.count = self.giftType
        LangUtil.GetSpriteLang(335 + self.giftType , function(sprite) self.monthCard:GetComponent("Image").sprite = sprite end)
        
        self.giftBut30S.gameObject:SetActive(self.giftType == 0 )
        self.giftBut7S.gameObject:SetActive(self.giftType == 1)
        self.giftBut3S.gameObject:SetActive(self.giftType == 2)
        self.monthCard.transform:Find("30_Effect").gameObject:SetActive(self.giftType == 0)
        self.monthCard.transform:Find("7_Effect").gameObject:SetActive(self.giftType == 1)
        self.monthCard.transform:Find("3_Effect").gameObject:SetActive(self.giftType == 2)
        self.count = (self.count +1)%3
    end
end

function this.OnAddListener(self)
    base.OnAddListener(self);
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnViewTop(self)
    base.OnViewTop(self)
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIComTop)
end

function this.OnDisViewTop(self)
    base.OnDisViewTop(self)
    UIManager:GetInstance():CloseWindow(UIWindowNames.UIComTop)
end

function this.OnDisable(self)
    base.OnDisable(self);
    self.face:Disable()
    --coroutine.start(function()
    --    coroutine.waitforframes(3)
    --    Game.Scene:GetComponent("BgmComponent"):CoPlay(BgmType.UI,"Home")
    --end)
    Game.Scene:GetComponent("SoundComponent"):Stop()
    Game.Scene:GetComponent("SoundComponent"):MainStop()
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this