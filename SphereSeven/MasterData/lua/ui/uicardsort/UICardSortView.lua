---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---

local UICardSortView = BaseClass("UICardSortView",UIBaseView);
local base = UIBaseView
local this = UICardSortView

local function SetButtonActive(btn, bool)
    local button = btn:GetComponent("Button")
    button.enabled = bool
    local disable = btn.transform:Find("Disable")
    if not IsNull(disable) then
        disable.gameObject:SetActive(not bool)
    end
end

local function SetActive(btn,bool)
    local transform = btn.transform
    transform:GetChild(0).gameObject:SetActive(bool)
end

local function IsActive(btn)
    local transform = btn.transform
    return transform:GetChild(0).gameObject.activeInHierarchy
end

local function OnClickConfirmBtn(self)
    self.callBack(self.cloneScreenTypes,self.recordOrder.kind)
    UIManager:GetInstance():CloseWindow(UIWindowNames.UICardSort)
end

function this.OnClickSortBtn(self,id)
    self.recordOrder.kind = id
    for k,v in pairs(self.sort_BtnTab) do
        SetActive(v,k == id)
    end
end

local function OnClickToggle(self,key,id)
    if IsActive(self.toggle_Tab[key][id])  then
        if key == 1 then
            table.removebyvalue(self.cloneScreenTypes.rare, id)
        elseif key == 2 then
            table.removebyvalue(self.cloneScreenTypes.class, id)
        elseif key == 3 then
            table.removebyvalue(self.cloneScreenTypes.prop, id)
        end
        SetActive(self.toggle_Tab[key][id],false)
        return
    end

    local ids
    if key == 1 then
        table.insert(self.cloneScreenTypes.rare, id)
        ids = self.cloneScreenTypes.rare
    elseif key == 2 then
        table.insert(self.cloneScreenTypes.class, id)
        ids = self.cloneScreenTypes.class
    elseif key == 3 then
        table.insert(self.cloneScreenTypes.prop, id)
        ids = self.cloneScreenTypes.prop
    end

    for k,v in pairs(self.toggle_Tab[key]) do
        SetActive(v,table.contains(ids, k))
    end
end

local function InitButtons(self)
    self:OnClickSortBtn(self.recordOrder.kind)
    for k,v in table.pairsByKeys(self.toggle_Tab[1]) do
        SetActive(v, table.contains(self.screenTypes.rare, k) )
    end

    for k,v in table.pairsByKeys(self.toggle_Tab[2]) do
        if self.model.data.currentClass == 0 then
            SetButtonActive(v,  true)
            SetActive(v, table.contains(self.screenTypes.class, k) )
        else
            SetButtonActive(v,  false)
            SetActive(v, false)
        end
    end

    for k,v in table.pairsByKeys(self.toggle_Tab[3]) do
        SetActive(v, table.contains(self.screenTypes.prop, k) )
    end
end


function this.OnLangCreate(self)
    local mainRoot=self.langRc:GetObject("MainRoot").transform
    LangUtil.BindText(self.langRc:GetObject("Title").transform).text = LangUtil.GetSysLang(187)
    
    LangUtil.GetSpriteLang(424, function(sprite) mainRoot:Find("Title1"):GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(425, function(sprite) mainRoot:Find("Title2"):GetComponent("Image").sprite = sprite end)
    LangUtil.GetSpriteLang(426, function(sprite) self.langRc:GetObject("Confirm").transform:Find("Image"):GetComponent("Image").sprite = sprite end)

    local btnRoot1 = mainRoot:Find("BtnCtrl")
    LangUtil.BindText(btnRoot1:GetChild(0):Find("Text")).text = LangUtil.GetSysLang(165)
    LangUtil.BindText(btnRoot1:GetChild(1):Find("Text")).text = LangUtil.GetSysLang(166)
    LangUtil.BindText(btnRoot1:GetChild(2):Find("Text")).text = LangUtil.GetSysLang(167)
    LangUtil.BindText(btnRoot1:GetChild(3):Find("Text")).text = LangUtil.GetSysLang(1182)
    LangUtil.BindText(btnRoot1:GetChild(4):Find("Text")).text = LangUtil.GetSysLang(169)
    LangUtil.BindText(btnRoot1:GetChild(5):Find("Text")).text = LangUtil.GetSysLang(170)
    LangUtil.BindText(btnRoot1:GetChild(6):Find("Text")).text = LangUtil.GetSysLang(171)
    LangUtil.BindText(btnRoot1:GetChild(7):Find("Text")).text = LangUtil.GetSysLang(172)
    LangUtil.BindText(btnRoot1:GetChild(8):Find("Text")).text = LangUtil.GetSysLang(173)
    LangUtil.BindText(btnRoot1:GetChild(9):Find("Text")).text = LangUtil.GetSysLang(1191)
    LangUtil.BindText(btnRoot1:GetChild(10):Find("Text")).text = LangUtil.GetSysLang(174)

    local btnRoot2 = mainRoot:Find("ToggleArea")

    --标签
    LangUtil.BindText(btnRoot2:GetChild(0):Find("Text/Text")).text = LangUtil.GetSysLang(166)
    LangUtil.BindText(btnRoot2:GetChild(1):Find("Text/Text")).text = LangUtil.GetSysLang(189)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("Text/Text")).text = LangUtil.GetSysLang(190)

    --稀有度
    LangUtil.BindText(btnRoot2:GetChild(0):Find("BtnCtrl"):GetChild(0):Find("Text")).text= "R"
    LangUtil.BindText(btnRoot2:GetChild(0):Find("BtnCtrl"):GetChild(1):Find("Text")).text= "SR"
    LangUtil.BindText(btnRoot2:GetChild(0):Find("BtnCtrl"):GetChild(2):Find("Text")).text= "SSR"

    --角色类型
    LangUtil.BindText(btnRoot2:GetChild(1):Find("BtnCtrl"):GetChild(0):Find("Text")).text=LangUtil.GetSysLang(SysLangKeys.ClassName[1])
    LangUtil.BindText(btnRoot2:GetChild(1):Find("BtnCtrl"):GetChild(1):Find("Text")).text=LangUtil.GetSysLang(SysLangKeys.ClassName[2])
    LangUtil.BindText(btnRoot2:GetChild(1):Find("BtnCtrl"):GetChild(2):Find("Text")).text=LangUtil.GetSysLang(SysLangKeys.ClassName[3])
    LangUtil.BindText(btnRoot2:GetChild(1):Find("BtnCtrl"):GetChild(3):Find("Text")).text=LangUtil.GetSysLang(SysLangKeys.ClassName[4])
    LangUtil.BindText(btnRoot2:GetChild(1):Find("BtnCtrl"):GetChild(4):Find("Text")).text=LangUtil.GetSysLang(SysLangKeys.ClassName[5])
    LangUtil.BindText(btnRoot2:GetChild(1):Find("BtnCtrl"):GetChild(5):Find("Text")).text=LangUtil.GetSysLang(SysLangKeys.ClassName[6])

    --属性
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(0):Find("Text")).text=LangUtil.GetSysLang(177)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(1):Find("Text")).text=LangUtil.GetSysLang(178)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(2):Find("Text")).text=LangUtil.GetSysLang(179)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(3):Find("Text")).text=LangUtil.GetSysLang(180)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(4):Find("Text")).text=LangUtil.GetSysLang(181)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(5):Find("Text")).text=LangUtil.GetSysLang(182)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(6):Find("Text")).text=LangUtil.GetSysLang(183)
    LangUtil.BindText(btnRoot2:GetChild(2):Find("BtnCtrl"):GetChild(7):Find("Text")).text=LangUtil.GetSysLang(184)
end


function this.OnCreate(self)
    base.OnCreate(self);

    EventTriggerListener.Get(self.rc:GetObject("EventBg")).onLuaClick = function()UIManager:GetInstance():CloseWindow(UIWindowNames.UICardSort) end
    
    self.sort_BtnCtrl = self.rc:GetObject("BtnCtrl").transform;
    self.sort_ToggleCtrl = self.rc:GetObject("ToggleArea").transform;
    self.sort_BtnTab = {};
    
    self.confirmBtn = self.rc:GetObject("ConfirmButton")
    self.toggle_Tab = {};

    for i = 0,self.sort_ToggleCtrl.childCount - 1 do
        local toggleParent = self.sort_ToggleCtrl:GetChild(i):Find("BtnCtrl")
        self.toggle_Tab[i+1] = {}
        for j = 0,toggleParent.childCount -1 do
            local toggle = toggleParent:GetChild(j).gameObject
            self.toggle_Tab[i+1][j+1] = toggle;
            UIUtil.AddBtnEvent(toggle,function(go)
                OnClickToggle(self,i+1,j+1)
            end)
        end
    end

    for i = 0,self.sort_BtnCtrl.childCount - 1 do
        local btn = self.sort_BtnCtrl:GetChild(i).gameObject;
        self.sort_BtnTab[i + 1] = btn
        UIUtil.AddBtnEvent(btn,function(v) self:OnClickSortBtn(i+1) end)
    end
    UIUtil.AddBtnEvent(self.confirmBtn,function(v) OnClickConfirmBtn(self)
    end)
end

function this.OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
end


function this.OnRefresh(self)
    self.player = Game.Scene.Player
   
    self.recordOrder = self.model.data.recordOrder
    self.screenTypes = self.model.data.screenTypes
    self.cloneScreenTypes = table.clone(self.screenTypes)
    self.callBack = self.model.data.callBack
    InitButtons(self)
end

function this.OnAddListener(self)
    base.OnAddListener(self)
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self);
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;

