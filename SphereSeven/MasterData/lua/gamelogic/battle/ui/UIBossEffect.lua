---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2020/11/5 19:24
---
local UIBossEffect = BaseClass("UIBossEffect", UIBaseView)
local this = UIBossEffect
local base = UIBaseView

local bossPrefab = ""

function this.OnCreate(self)
    base.OnCreate(self)
    bossPrefab = PathUtil.Path_UIBattleEffects..LangUtil.GetLangName("BOSS")..".prefab"
    self.Image = self.rc:GetObject("Image"):GetComponent("Image")
    self.Image:DOFade(1,0)
end

function this.ShowEffect(self)
    coroutine.start(function ()
        local efx = GameObjectPool:GetInstance():CoGetGameObjectAsync(bossPrefab)
        local img = self.transform:Find("Image"):GetComponent("Image")
        img:DOFade(1, 0)
        table.csenu(efx:GetComponentsInChildren(typeof(Transform)),function (v)
            v.gameObject.layer = LayerMask.NameToLayer("UI")
        end)
        table.csenu(efx:GetComponentsInChildren(typeof(CS.UnityEngine.ParticleSystemRenderer)),function (smr)
            smr.sortingOrder = self.canvas.unity_canvas.sortingOrder + 1
        end)
        efx.transform:SetParent(self.gameObject.transform, false)
        Game.Scene:GetComponent("SoundComponent"):CoPlay(CommonSoundPath.bossSound)
        coroutine.waitforseconds(3)
        img:DOFade(0, 1)
        coroutine.waitforseconds(1)
        GameObjectPool:GetInstance():RecycleGameObject(bossPrefab, efx)
    end)
end

function this.OnEnable(self)
    base.OnEnable(self)
    self:ShowEffect()
end

function this.OnDisable(self)
    base.OnDisable(self)
end

function this.OnDestroy(self)
    base.OnDestroy(self)
end

return this
