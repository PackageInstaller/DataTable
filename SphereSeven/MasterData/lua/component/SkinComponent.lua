---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by daiyi.
--- DateTime: 2019/4/11 22:28
---
local SkinComponent = BaseClass("SkinComponent", Component)
local base = Component


local function Awake(self)
    base.Awake(self)
    self.Skins = {}
end

local function CoLoadData(self)
    local info = coroutine.yieldstart(Game.Scene.Session.CoCall,nil,Game.Scene.Session,
            OuterOpcode.Name2Code.ETModel_C2M_SkinInfo, {})
    if info.Error == ErrorCode.ERR_Success then
        for _,v in ipairs(info.SkinInfoList) do
            self:Add(Game.Registry:NewObject("Skin",v),true)
        end
    else
        Logger.LogError("ETModel_C2M_ChallengeInfo:"..info.Error)
    end
    return coroutine.yieldbreak(info)
end


local function Add(self,skin,noRecord)
    self.Skins[skin.Id] = skin
end

local function Get(self,id)
    return self.Skins[id]
end

local function GetNotBuySkins(self)
    -- 可购买的皮肤
    local canBuySkins = table.choose(Z_Skin,function(k, v)
        return v.StorePrice ~= 0 and Z_Card[v.BelongCard].NotOpen ~= 1 and v.MarryUnlock ~= 1 and not table.any(self.Skins,function(a) return a.TemplateId == v.Id end)
    end)
    return canBuySkins
end

local function Dispose(self)
    base.Dispose(self)

    for _,v in pairs(self.Skins) do
        v:Dispose()
    end
end

SkinComponent.Awake = Awake
SkinComponent.Add = Add
SkinComponent.Dispose = Dispose
SkinComponent.CoLoadData=CoLoadData
SkinComponent.Get=Get
SkinComponent.GetNotBuySkins = GetNotBuySkins
return SkinComponent