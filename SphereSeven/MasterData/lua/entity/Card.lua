---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/4 14:20
---
---@class Card : Entity
local Card = BaseClass("Card",Entity)
local base = Entity

---@param self Card
local function Awake(self,cardInfo)
    base.Awake(self)
    if cardInfo ~= nil then
        self.Id = cardInfo.CardId
        self.TemplateId = cardInfo.TemplateId
        self.Level = cardInfo.Level
        self.LevelLimit = tonumber(Z_Misc["CHARACTER_LEVEL_LIMIT"].Value[1]) 
        -- if cardInfo.Stage ~=nil then
        --     self.Stage = (cardInfo.Stage > 3 and {3} or {cardInfo.Stage})[1]
        -- else
        --     self.Stage = cardInfo.Stage 
        -- end
        self.Stage = 1
        self.Star = cardInfo.Star
        self.Exp = cardInfo.Exp
        self.CloseDegree = cardInfo.CloseDegree
        self.SkinId = (cardInfo.SkinId == 0 and {1} or {cardInfo.SkinId})[1]
        self.Lock = cardInfo.Lock
        self.Hand1Equip = cardInfo.Hand1Equip
        self.Hand2Equip = cardInfo.Hand2Equip
        self.BodyEquip = cardInfo.BodyEquip
        self.HeadEquip = cardInfo.HeadEquip
        self.FootEquip = cardInfo.FootEquip
        self.AdornEquip = cardInfo.AdornEquip
        self.FightSoul1 = cardInfo.FightSoul1
        self.FightSoul2 = cardInfo.FightSoul2
        self.FightSoul3 = cardInfo.FightSoul3
        self.Support = cardInfo.Support
        self.JadePearlLevel = cardInfo.JadePearlLevel
        self.PlayedNum=cardInfo.PlayedNum
        ----------------------------------2023新增---------------------------------------
        self.Id = cardInfo.id
        self.Level = cardInfo.level
        self.Exp = cardInfo.exp
        self.Intimacy = cardInfo.intimacy
        self.Bead = cardInfo.bead
        self.Constellation = cardInfo.constellation
        self.Star = cardInfo.star
        self.Skin = cardInfo.skin
        self.Skills = cardInfo.skills
        self.TemplateId = cardInfo.id
        self.marry = cardInfo.marry

        if cardInfo.equipments ~= nil then
            for _, value in ipairs(cardInfo.equipments) do
                if value.slot == EquipmentSlot.EquipmentSlotMainHand then
                    self.Hand1Equip = value.eid
                elseif value.slot == EquipmentSlot.EquipmentSlotSecondaryWeapon then
                    self.Hand2Equip = value.eid
                elseif value.slot == EquipmentSlot.EquipmentSlotBody then
                    self.BodyEquip = value.eid
                elseif value.slot == EquipmentSlot.EquipmentSlotHead then
                    self.HeadEquip = value.eid
                elseif value.slot == EquipmentSlot.EquipmentSlotFoot then
                    self.FootEquip = value.eid
                elseif value.slot == EquipmentSlot.EquipmentSlotAccessory then
                    self.AdornEquip = value.eid
                end
            end
        end
        
        --- 战斗兼容
        self.SkinId = self.Skin
        --self.Stage = self.Star
        self.JadePearlLevel = self.Bead
        self.CloseDegree = self.Intimacy
        self.Config = Z_Character[self.Id]

        ---------------------------------------------------------------------------------------
        local constelLevel = cardInfo.ConstelLevel and cardInfo.ConstelLevel or 0
        self.ConstelLevel = Game.Registry:NewObject("CheatData", constelLevel)
    else
        self.ConstelLevel = Game.Registry:NewObject("CheatData", 0)
    end
end

local function InitCardComponent(self)
    self:AddComponent("NumericComponent")
    self:AddComponent("CardCharacterComponent")
    self:AddComponent("CardEquipComponent")
    self:AddComponent("CardJadePearlComponent")
    self:AddComponent("CardConstelComponent")
    self:AddComponent("CardIntimacyComponent")
    self:AddComponent("CardEncyclopediaComponent")
end

local function UpdateCarddata(self)
    self:GetComponent("NumericComponent"):Awake()
    self:GetComponent("CardCharacterComponent"):Awake()
    self:GetComponent("CardEquipComponent"):Awake()
    self:GetComponent("CardJadePearlComponent"):Awake()
    self:GetComponent("CardConstelComponent"):Awake()
    self:GetComponent("CardIntimacyComponent"):Awake()
    self:GetComponent("CardEncyclopediaComponent"):Awake()
end

local function GetAttri(self, type)
    if type == 50 then
        return self.ConstelLevel:Get()
    end
    
    return 0
end

local function SetAttri(self, type, val)
    if type == 50 then
        return self.ConstelLevel:Set(val)
    end

    return 0
end

local function Dispose(self)
    base.Dispose(self)
end

Card.Awake = Awake
Card.Dispose = Dispose
Card.InitCardComponent = InitCardComponent
Card.GetAttri = GetAttri
Card.SetAttri = SetAttri
Card.UpdateCarddata = UpdateCarddata

return Card