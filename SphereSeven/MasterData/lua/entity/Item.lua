---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/4 15:12
---
---@class Item : Entity
---@field Id number @ 相当于uid
---@field TemplateId number @ 表中id
---@field Amount number
---@field config table @ excel数据
local Item = BaseClass("Item",Entity);
local base = Entity

---@param itemInfo protocol.Item
function Item:Awake(itemInfo)
    base.Awake(self)
    if itemInfo ~= nil then
        self.Id = itemInfo.uid
        self.TemplateId = itemInfo.cid
        self.Amount = itemInfo.count
        self.createTime = itemInfo.create_time or 0
        self.expireTime = itemInfo.expire_time or 0
        self.config = Z_Item[self.TemplateId]
    end
end

function Item:UpdateHint()
    ---@type HintComponent
    local hintComponent = Game.Scene:GetComponent("HintComponent")

    if self.config.Type == ItemType.ReasureBox or self.config.Type == ItemType.Material then
        if self.expireTime ~= 0 and self.expireTime <= TimeUtil.GetServerTime() + 7 * 24 * 60 * 60 then
            hintComponent.Item:GetChild(Z_Item[self.TemplateId].Type):GetChild(self.Id):SetCount(1)
        else
            hintComponent.Item:GetChild(Z_Item[self.TemplateId].Type):GetChild(self.Id):SetCount(0) 
        end
    end
    -- 在remove的时候也要刷新
    if UIPublic.isFreeRecruitItemId(self.TemplateId) then
        ---@type RecruitComponent
        local recruitComponent = Game.Scene.Player:GetComponent("RecruitComponent")
        if recruitComponent ~= nil then
            for index, value in ipairs(recruitComponent:GetPoolList()) do
                value:UpdateHint()
            end
        end
    end
end

local function Dispose(self)
    base.Dispose(self)
end

Item.Dispose = Dispose

return Item