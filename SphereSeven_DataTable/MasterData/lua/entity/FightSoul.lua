---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/4 15:08
---

---@class FightSoul : Entity
---@field Id number @ 唯一标识
---@field TemplateId number @ 战魂id -- 读表
---@field exp number @ 当前经验值
---@field level number @ 等级
---@field maxLevel number @ 最大等级(跟星级有关, 星级变化时同步更新)
---@field Star number @ 星级 从1开始
---@field Lock boolean @ 是否锁定
---@field isEquip boolean @ 是否上阵
---@field config table @ excel数据
---@field propertyConfig table
---@field equipFormationList string[] @ 在哪些队伍中装备了
local FightSoul = BaseClass("FightSoul",Entity)
local base = Entity

local propertyKey = {
    [NumericType.Hp] = "Hp",
    [NumericType.Atk] = "Atk",
    [NumericType.Def] = "Def",
    [NumericType.MagicDef] = "MDef",
}

---@param self FightSoul
local function Awake(self,fightSoulInfo)
    base.Awake(self)
    if fightSoulInfo ~= nil then
        self.Id = fightSoulInfo.uid
        self.exp = fightSoulInfo.exp
        self.level = fightSoulInfo.level
        self.Lock = fightSoulInfo.isLocked
        self.Star = fightSoulInfo.mergeLevel
        self.maxLevel = tonumber(Z_Misc["FIGHT_SOUL_LEVEL_LIMIT_BY_MERGE"].Value[self.Star])
        self.isEquip = false

        self.TemplateId = fightSoulInfo.cid
        self.config = Z_FightSoul[self.TemplateId]
        self.propertyConfig = Z_FightSoulLevelGrowth[self.TemplateId]
        self.equipFormationList = {}
    end
end

local function GetProperty(self, property)
    return self.propertyConfig[self.level][propertyKey[property]]
end

local function UpdateData(self, fightSoulInfo)
    self.Id = fightSoulInfo.uid or self.Id
    self.exp = fightSoulInfo.exp 
    self.level = fightSoulInfo.level
    self.Lock = fightSoulInfo.isLocked
    self.Star = fightSoulInfo.mergeLevel
    self.maxLevel = tonumber(Z_Misc["FIGHT_SOUL_LEVEL_LIMIT_BY_MERGE"].Value[self.Star])
end

---@param self FightSoul
local function ChangeEquip(self, isEquip)
    -- if isEquip then
    --     if table.contains(self.equipFormationList, id) then
    --         return
    --     end
    --     table.insert(self.equipFormationList, id)
    --     self.isEquip = true
    -- else
    --     table.removebyvalue(self.equipFormationList, id)
    --     if table.count(self.equipFormationList) == 0 then
    --         self.isEquip = false
    --     end
    -- end
    self.isEquip = isEquip
end

local function Dispose(self)
    base.Dispose(self)
end

FightSoul.Awake = Awake
FightSoul.Dispose = Dispose
FightSoul.GetProperty = GetProperty
FightSoul.UpdateData = UpdateData
FightSoul.ChangeEquip = ChangeEquip

return FightSoul