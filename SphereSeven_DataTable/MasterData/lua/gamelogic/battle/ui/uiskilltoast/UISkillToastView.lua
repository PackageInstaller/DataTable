---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by daiyi.
--- DateTime: 2019/6/21 17:53
---
local UISkillToastView = BaseClass("UISkillToastView",UIBaseView)
local this = UISkillToastView
local base = UIBaseView

function this.OnCreate(self)
    base.OnCreate(self)
    EventTriggerListener.Get(self.rc:GetObject("EventBg")).onLuaClick = function() self.ctrl:CloseSelf() end
    self.icon = self.rc:GetObject("Icon"):GetComponent("Image")
    self.name = LangUtil.BindText(self.rc:GetObject("Name"))
    self.np = LangUtil.BindText(self.rc:GetObject("NP"))
    self.desc = LangUtil.BindText(self.rc:GetObject("Desc"))
    self.contentRoot = self.rc:GetObject("ContentRoot")
    self.CD = self.rc:GetObject("CD")
    self.fitter = self.contentRoot:GetComponent("ContentSizeFitter")
    self.oldPos = self.contentRoot.transform.localPosition
end

function this.OnEnable(self)
    base.OnEnable(self)
    self:OnRefresh()
end

function this.OnRefresh(self)
    --self.contentRoot.transform.localPosition = Vector3.New(-9999, -9999, -9999)
    local _skill = self.model.Skill
    self.fitter.enabled = false
    
    -- 名字
    local name = _skill.Name--"<color=#fff2aa>".._skill.Name.."</color>"
    self.name.text = name

    -- local cooldownTurn = UIData.GetSkillAttr(SkillAttr.CooldownTurn, _skill.ZSkill, _skill.SrcUnit.BattleCharacter)

    -- -- 冷却
    self.np.text = _skill.CooldownTurn
    -- if _skill.CooldownTurn > 0 then
    --     self.np.gameObject:SetActive(true)
    --     self.np.text = _skill.CooldownTurn
    -- else
    --     self.np.gameObject:SetActive(false)
    --     self.CD.gameObject:SetActive(false)
    -- end
    
    -- 描述
    local desc = _skill:GetDesc()
    self.desc.text = string.sub(desc, 2, -2)
    -- 亲密度
    -- if _skill.IsCloseFull and not string.IsNullOrEmpty(_skill.ZSkill.CloseFullEfx) then
    --     desc = desc.."\n<color=#fff2aa>"..LangUtil.GetSysLang(170).."Max：</color>\n".._skill.ZSkill.CloseFullEfx
    -- end

    UIUtil.SetSprite(self.icon, AtlasConfig.SkillIcon, _skill.ZSkill.SkillIcon)

    -- coroutine.start(function ()
    --     coroutine.waitforframes(1)
    --     UIUtil.SetSprite(self.icon, AtlasConfig.SkillIcon, _skill.ZSkill.SkillIcon)
    --     self.fitter.enabled = true
    --     self.desc.text = desc
    --     coroutine.waitforframes(1)
    --     self.fitter.enabled = false
    --     coroutine.waitforframes(1)
    --     self.fitter.enabled = true
    --     coroutine.waitforframes(1)
    --     self.contentRoot.transform:DOLocalMove(Vector3.New(self.oldPos.x, self.contentRoot:GetComponent("RectTransform").sizeDelta.y / 2, 0), 0)
    -- end)
end

return this