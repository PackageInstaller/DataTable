---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by daiyi.
--- DateTime: 2019/7/18 14:14
--- 刘彻
---自身使用技能3后自身获得【神行】、【无双】效果持续2回合
local FightSoul_30024 = BaseClass("FightSoul_30024",Skill)
local base = Skill

local function __init(self)
end

local function GetEnemyDebuffCount(self)
    local enemies = self:__get_enemy_all()
    local totalCount = 0
    for _, enemy in pairs(enemies) do
        local debuffs = enemy:GetComponent("BuffComponent"):GetAllBuff(true, false)
        local count = table.count(debuffs)
        totalCount = totalCount + count
    end
    return totalCount
end

local function OnUnitSelfTurnStart(self)
    base.OnUnitSelfTurnStart(self)
    
    local totalCount = GetEnemyDebuffCount(self)

    local probability = totalCount * self.Params[1]
    if probability > 100 then
        probability = 100
    end
    if BattleUtil.IsPctProbHit(probability) then
        self.__sbc:CreateBuff(10002, self.SkillId, self.SrcUnit, self.SrcUnit, 1)
    end
end

local function OnUnitSelfTurnEnd(self)
    base.OnUnitSelfTurnEnd(self)

    local totalCount = GetEnemyDebuffCount(self)
    local hp = math.floor(totalCount * self.SrcUnit:GetComponent("NumericComponent"):Get(NumericType.Atk) * self.Params[2] / 100)
    if hp > 0 then
        self.__subc:HealHp(hp)
    end
end

FightSoul_30024.__init = __init
FightSoul_30024.OnUnitSelfTurnStart = OnUnitSelfTurnStart
FightSoul_30024.OnUnitSelfTurnEnd = OnUnitSelfTurnEnd

return FightSoul_30024