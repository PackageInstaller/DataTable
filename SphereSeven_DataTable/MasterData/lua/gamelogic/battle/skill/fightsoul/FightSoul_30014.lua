---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by daiyi.
--- DateTime: 2019/7/18 11:34
--- 太公望
---
local FightSoul_30014 = BaseClass("FightSoul_30014",Skill)
local base = Skill

local function __init(self)
    self.Data.IsTriggered = false
end

local function OnActEnd(self)
    base.OnActEnd(self)

    if self.__bc.CurActSkill.ZSkill == nil then
    end
    if self.__bc.CurActSkill.ZSkill.SkillType ~= BattleSkillType.Assist then
        return
    end
    
    if not BattleUtil.IsPctProbHit(self.Params[1]) then
        return
    end

    local value = 0
    local enemies = self:__get_enemy_all()
    local targetUnit 
    for _, unit in pairs(enemies) do
        local atk = unit:GetComponent("NumericComponent"):Get(NumericType.Atk)
        if atk > value and not unit:GetComponent("BuffComponent"):HasBuffId(20020) then
            targetUnit = unit
            value = atk
        end
    end

    if targetUnit then
        targetUnit:GetComponent("BuffComponent"):CreateBuff(20020, 0, self.SrcUnit, targetUnit, 1)
    end
    self.Data.IsTriggered = true
end

local function BeforeHit(self, activeSkillResult, targetUnit)
    if self.Data.IsTriggered then
        activeSkillResult.ExtraFinalDamagePct = activeSkillResult.ExtraFinalDamagePct + self.Params[1]
    end
end

FightSoul_30014.__init = __init
FightSoul_30014.OnActEnd = OnActEnd
FightSoul_30014.BeforeHit = BeforeHit

return FightSoul_30014