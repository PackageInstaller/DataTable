---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by daiyi.
--- DateTime: 2019/4/15 23:05
---
local SsUnitSoundComponent = BaseClass("SsUnitSoundComponent",Component)
local base = Component
CommonSoundPath={
   prySound = "Sound/Battle/Pry.mp3", -- 加速
   blkSound = "Sound/Battle/Block.mp3", -- 加速
   buffSound = "Sound/Battle/GetBuff.mp3", -- 加速
   battleStartSound = "Sound/Battle/BattleStart.mp3", -- 加速
   bossSound = "Sound/Battle/Boss.mp3", -- 加速
   battleLose = "Sound/Battle/Lose.mp3",
   battleWin = "Sound/Battle/Win.mp3",
}

local function Awake(self)
    base.Awake(self)
    self.audio_source = self.__entity.GameObject:AddComponent(typeof(AudioSource))
end

local function CoPlayCommon(self,resPath)
    if string.IsNullOrEmpty(resPath) then return end

    coroutine.start(function()
        local asset = ResourcesManager:GetInstance():CoLoadAsync(resPath,typeof(AudioClip))
        if self.is_disposed then
            return
        end

        self.audio_source.clip = asset
        self.audio_source.volume = ClientData:GetInstance():GetVolume("SoundVolume")
        self.audio_source:Play()
     end)
end

-- Fire_Common（卡麦尔战魂被动） -- 这些不在这播放：Gain2（信条通用） Weaken（信条通用） HeavenStorm2（帝王风暴通用）
--通用型为_Common结尾  不然就在角色资源目录 Sound 文件夹下 特效的声音 需要加速
local function CoPlaySkl(self,name)
    if string.IsNullOrEmpty(name) then return end
    local soundPath
    if string.endswith(name,"_Common") then
        soundPath = "Sound/Battle/"..name..".mp3"
    else
        soundPath=self.__entity.ZSsUnit.AbDir.."/Battle/Sound/"..name
    end

    coroutine.start(function()
        local asset = ResourcesManager:GetInstance():CoLoadAsync(soundPath,typeof(AudioClip))

        if self.is_disposed then
            return
        end

        self.audio_source.pitch = Game.Scene:GetComponent("BattleComponent").BattleSpeed
        self.audio_source.clip = asset
        self.audio_source.volume = ClientData:GetInstance():GetVolume("CardVolume")
        self.audio_source:Play()
    end)
end

local function Dispose(self)
    base.Dispose(self)
    --self.Entity.GameObject:RemoveComponent(typeof(CS.UnityEngine.AudioSource))
end

SsUnitSoundComponent.Awake = Awake
SsUnitSoundComponent.CoPlayCommon = CoPlayCommon
SsUnitSoundComponent.CoPlaySkl = CoPlaySkl
SsUnitSoundComponent.Dispose = Dispose

return SsUnitSoundComponent