---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by daiyi.
--- DateTime: 2019/4/15 16:45
---
---@alias SsUnit SsUnit
local SsUnit = BaseClass("SsUnit",Entity)
local base = Entity

local function Awake(self,UID)
    base.Awake(self)
    self.UID = UID  --单位ID
    self.Name = nil  --名称
    self.GameObject = nil  
    self.IsPlayer = false   --是否是己方
    self.IsMonster = false  --是否是怪物
    self.IsBoss = 0
    self.CloseAtkOffset = nil --近战攻击偏移
    self.HitPosPosition = nil --受击位置
    self.UnitShadow = nil --阴影
    self.CurActUnitFlag = nil --当前行动标记
    self.ChooseTargetFlag = nil --选择目标标记
    self.TargetChooseRing = nil --被选光圈
    self.HandleTrans = nil --挂点1
    self.Handle2Trans = nil -- 挂点2
    self.Handle3Trans = nil -- 挂点3
    self.Handle4Trans = nil -- 挂点4
    self.Handle5Trans = nil -- 挂点5
    self.Handle6Trans = nil -- 挂点6
    self.Handle7Trans = nil -- 挂点7
    self.BuffHandleTrans = nil --buff挂点
    self.ZSsUnit = nil --单位配置
    self.BattleCharacter = nil --角色
    self.ZCard = nil --角色配置
    --self.ZSkillEfx = nil
    self.UseSkill=nil
    self.Scale=nil
    self.Pos=nil

    -- 继承血量
    self.ExtendHp = nil
    
    self.Height = nil
end

local function SetPosition(self,position)
    self.GameObject.transform.position = position
end

local function GetPosition(self)
    return self.GameObject.transform.position
end

local function SetRotation(self,rotation)
    self.GameObject.transform.rotation = rotation
end

local function GetRotation(self)
    return self.GameObject.transform.rotation
end

local function GetHeight(self, type)
    local yScale = self.ZSsUnit.UnitScale > 0 and self.ZSsUnit.UnitScale or 1
    if self.Height == nil then
        local cc = self.GameObject:GetComponent(typeof(CS.UnityEngine.CapsuleCollider))
        self.Height = cc.height * yScale
        if cc.direction == 0 then--横着的，非正常，利维坦
            self.Height = (cc.center.y + cc.radius) * yScale
        end
    end
    
    -- 光标挂在有缩放的角色节点下面
    if type == 1 then
        return (self.Height + 0.9) / yScale
    elseif type == 2 then
        return self.Height + 0.7
    elseif type == 3 then
        return self.Height + 0.05
    elseif type == 4 then
        return self.Height / yScale + 0.05
    end
    return self.Height
end

local function GetFootPos(self)
    local yScale = self.ZSsUnit.UnitScale > 0 and self.ZSsUnit.UnitScale or 1
    local cc = self.GameObject:GetComponent(typeof(CS.UnityEngine.CapsuleCollider))
    local footHeight = 0
    if cc.direction == 0 then
        footHeight = (cc.center.y - cc.radius) * yScale
    else
        footHeight = (cc.center.y - cc.height / 2) * yScale
    end
    return Vector3.New(self.GameObject.transform.position.x, footHeight, self.GameObject.transform.position.z)
end

local function GetCenterPos(self)
    local yScale = self.ZSsUnit.UnitScale > 0 and self.ZSsUnit.UnitScale or 1
    local cc = self.GameObject:GetComponent(typeof(CS.UnityEngine.CapsuleCollider))
    local footHeight = 0
    if cc.direction == 0 then
        footHeight = cc.center.y * yScale
    else
        footHeight = cc.center.y * yScale
    end
    return Vector3.New(self.GameObject.transform.position.x, footHeight, self.GameObject.transform.position.z)
end

local function SetDim(self)
    local skinnedMeshRenderers = self.GameObject:GetComponentsInChildren(typeof(CS.UnityEngine.SkinnedMeshRenderer))
    table.csenu(skinnedMeshRenderers, function(v)
        table.csenu(v.materials, function(v)
            v.color = CS.UnityEngine.Color(50/255,50/255,50/255,1)
        end)
    end)
end

local function ResetDim(self)
    local skinnedMeshRenderers = self.GameObject:GetComponentsInChildren(typeof(CS.UnityEngine.SkinnedMeshRenderer))
    table.csenu(skinnedMeshRenderers, function(v)
        table.csenu(v.materials, function(v)
            if self:GetComponent("CharacterComponent").IsHide > 0  then
                v.color = CS.UnityEngine.Color(1,1,1,0.3)
            else
                v.color = CS.UnityEngine.Color(1,1,1,1)
            end
        end)
    end)
end

local function SetExtendHp(self, hp)
    self.ExtendHp = hp
end

local function InitHp(self)
    local numericComponent = self:GetComponent("NumericComponent")
    local hp = self.ExtendHp or numericComponent:Get(NumericType.MaxHp)
    numericComponent:Set(NumericType.Hp, hp)
end

local function Dispose(self)
    self.UseSkill=nil
    base.Dispose(self)
    CS.UnityEngine.Object.Destroy(self.GameObject)
end

SsUnit.Awake = Awake
SsUnit.SetPosition = SetPosition
SsUnit.GetPosition = GetPosition
SsUnit.SetRotation = SetRotation
SsUnit.GetRotation = GetRotation
SsUnit.GetFootPos = GetFootPos
SsUnit.GetCenterPos = GetCenterPos
SsUnit.GetHeight = GetHeight
SsUnit.SetDim = SetDim
SsUnit.ResetDim = ResetDim
SsUnit.SetExtendHp = SetExtendHp
SsUnit.InitHp = InitHp
SsUnit.Dispose = Dispose

return SsUnit