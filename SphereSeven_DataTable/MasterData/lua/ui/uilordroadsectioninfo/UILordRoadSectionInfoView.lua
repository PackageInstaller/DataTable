---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---

local UILordRoadSectionInfoView = BaseClass("UILordRoadSectionInfoView",UIBaseView);
local base = UIBaseView
local this = UILordRoadSectionInfoView
local default = 3

local function InitSectionPanel(self,zStoryLevel)
    local zSection = table.first(Z_LordRoad,function(v) return zStoryLevel.Id == v.LevelId  end)
    self.APTxt.text = "AP ".. zStoryLevel.EnergyExpend
    self.titleTxt.text = zSection.LevelTitle
    self.LevelText.text = LangUtil.GetSysLang(500) .. zStoryLevel.HintLevel
    --self.isPass:SetActive(zSection.Id <= self.completedLordRoad)
    --self.isPass:SetActive(false)
    self.labeld:SetActive(zSection.Id > self.completedLordRoad)

    self.selectLevel = zSection.Id

    local launchAtkData = {}
    launchAtkData.CurLevelId = self.selectLevel
    launchAtkData.CurLevelDifficulty = default
    launchAtkData.LevelType = LevelType.LevelTypeTower
    UIBattelModeInfo.InitMonsterArea(self.monsterRoot, zStoryLevel, launchAtkData)
end

local function OnClickReadyButton(self) --点击出击准备
    local sectionId = self.selectLevel
    local diff = default
    local zStoryLevel = Z_LordRoadLevel[sectionId]
    local launchAtkData = {}
    launchAtkData.Skip = false
    launchAtkData.CurLevelId = sectionId
    launchAtkData.CurLevelDifficulty = diff
    launchAtkData.LevelType = LevelType.LevelTypeTower
    launchAtkData.EnergyExpend = zStoryLevel.EnergyExpend
    UIManager:GetInstance():CloseWindow(UIWindowNames.UILordRoadSectionInfo)
    UIUtil.OpenFormat(launchAtkData)
end

function this.OnCreate(self)
    base.OnCreate(self);
    --self.isPass = self.rc:GetObject("IsPass").gameObject
    self.itemRoot = self.rc:GetObject("ItemRoot").transform
    self.labeld = self.rc:GetObject("Labeld")
    self.monsterRoot = self.rc:GetObject("MonsterRoot").transform
    self.readyBtn = self.rc:GetObject("AtkButton")
    local eventBg = self.rc:GetObject("EventBg")
    UIUtil.AddBtnEvent(self.rc:GetObject("CloseButton"),function(go) UIManager:GetInstance():CloseWindow(UIWindowNames.UILordRoadSectionInfo) end)
    EventTriggerListener.Get(eventBg).onLuaClick = function() UIManager:GetInstance():CloseWindow(UIWindowNames.UILordRoadSectionInfo) end
    UIUtil.AddBtnEvent(self.readyBtn,function(go) OnClickReadyButton(self) end)
end

function this.OnLangCreate(self)
    LangUtil.BindText(self.rc:GetObject("TitleText")).text = LangUtil.GetSysLang(501)
    LangUtil.BindText(self.rc:GetObject("MonsterText")).text = LangUtil.GetSysLang(497)
    LangUtil.BindText(self.itemRoot.transform:Find("Text")).text = LangUtil.GetSysLang(498)
    LangUtil.BindText(self.labeld).text = LangUtil.GetSysLang(499)
    LangUtil.BindText( self.readyBtn.transform:Find("Text")).text = LangUtil.GetSysLang(92)
    self.LevelText = LangUtil.BindText(self.rc:GetObject("LevelText"))
    self.titleTxt = LangUtil.BindText(self.rc:GetObject("Title"))
    self.APTxt = LangUtil.BindText(self.rc:GetObject("Ap"))
    self.nameTxt = LangUtil.BindText(self.itemRoot:Find("Name"))
    self.iconName = LangUtil.BindText(self.itemRoot:Find("Icon/Name"))
end

function this.OnEnable(self)
    base.OnEnable(self)
    self.player = Game.Scene.Player
    local storyComponent =  self.player:GetComponent("StoryComponent")
    self.completedLordRoad = storyComponent.CompletedLordRoad
    local info = self.model.info
    self.zStoryLevel = info.zStoryLevel
    self:OnRefresh();
end

function this.OnRefresh(self)
    InitSectionPanel(self,self.zStoryLevel)
end

function this.OnAddListener(self)
    base.OnAddListener(self)
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self);
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;

