---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/3 13:59
---

local UITestLaunchAtkCtrl = BaseClass("UITestLaunchAtkCtrl",UIBaseCtrl);


local function OnSectionChg(self,id,difficulty)
    UIData.SetSectionId(id,difficulty);
end

local function LaunchAtk(data)
    local ac=Game.Scene:GetComponent("AgainstComponent")
    --ac.CurLevelId = data.CurLevelId;
    --ac.CurLevelDifficulty = data.CurLevelDifficulty;
    ac:SetCurLevel(data)
    Game.Scene.SceneComponent:SwitchScene(SceneConfig.BattleScene)
end


local function OnQuickBattle(self,data)
    print(table.dump(data));
    if data.Skip then
        LaunchAtk(data)
    else
        local curLevelId = Game.Scene:GetComponent("AgainstComponent").CurLevelId
        if Z_StorySection[curLevelId].StoryScript == "" then
            LaunchAtk(data)
        else
            local zStoryScript = require("Config/Excel/Z_StoryScript_"..Z_StorySection[curLevelId].StoryScript)
            Game.Scene:GetComponent("FungusComponent"):ExecuteBlock(zStoryScript, function() LaunchAtk(data) end)
        end
    end
end

local function SendMopUpRequest(self,data)
    data.LevelTypeInfo = 0
    local player = Game.Scene.Player
    coroutine.start(function()
        local g2cBattleSettle = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
                OuterOpcode.Name2Code.ETModel_C2M_BattleSettle, data);
        if g2cBattleSettle.Error == ErrorCode.ERR_Success then
            UIUtil.BattleSettle(g2cBattleSettle,data);
        else
            UIUtil.ToolTipThird("", LangUtil.GetServerError(g2cBattleSettle.Error))
        end
    end)
end


local function SendCustoms(levelId,diff) --发送通关请求
    coroutine.start(function ()
        local reqData = {
            LevelTypeInfo = 0,
            LevelId = levelId,
            Difficulty = diff,
            IsReachRewardCond1 = 1,
            IsReachRewardCond2 = 1,
            IsReachRewardCond3 = 1,
        }
        local response =coroutine.yieldstart(Game.Scene.Session.CoCall,nil,Game.Scene.Session,
                OuterOpcode.Name2Code.ETModel_C2M_BattleSettle,reqData)
        DataManager:GetInstance():Broadcast(DataMessageNames.ON_MAIN_STORY_CHG)
        if response.Error == ErrorCode.ERR_Success then
           
        end
    end)
end

local function PlaySectionStory(self,data,diff)
    local tipData = {};
    tipData.title = LangUtil.GetSysLang(9)--"提示";
    tipData.message = LangUtil.GetSysLang(237)--"当前为播放剧情关卡,是否播放?";
    tipData.callBack = function()
        local storyId = data.StoryScript;
        local zStoryScript = require("Config/Excel/Z_StoryScript_"..storyId);
        Game.Scene:GetComponent("FungusComponent"):ExecuteBlock(zStoryScript, function() SendCustoms(data.Id,diff) end)
    end
    UIUtil.ToolTipFirst(tipData);
end

local function OpenFormatWindow(self)
    print("--打开编成面板")
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIFormatNew);
end


local function OpenSelectWindow(self)
    print("--打开选择界面")
    UIData.select = self.model:GetSelectData();
    UIManager:GetInstance():OpenWindow(UIWindowNames.UISelect);
end

local function OpenReadyWindow(self,data)
    print("--打开准备界面");
    UIUtil.OpenFormat(data);
end

local function OnOpenMonsterMessageWindow(monsterData)
    print("--打开敌人详情界面");
    local showData = {};
    showData.monster = monsterData;
    showData.showType = 4;
    UIUtil.OpenThingsDetailWindow(showData);
end

local function OnOpenItemMessageWindow(gameObject)
    print("--打开物品详情界面");
    local showData = gameObject:GetComponent("BindData"):Get("showData");
    UIUtil.OpenThingsDetailWindow(showData);
end

local function CloseSelf()
    UIManager:GetInstance():CloseWindow(UIWindowNames.UITestLaunchAtk);
end

local function OpenIntensWindow()
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIMainIntens);
end
UITestLaunchAtkCtrl.OpenIntensWindow = OpenIntensWindow
UITestLaunchAtkCtrl.OnSectionChg = OnSectionChg
UITestLaunchAtkCtrl.OnOpenMonsterMessageWindow = OnOpenMonsterMessageWindow
UITestLaunchAtkCtrl.OnOpenItemMessageWindow = OnOpenItemMessageWindow
UITestLaunchAtkCtrl.OpenFormatWindow = OpenFormatWindow
UITestLaunchAtkCtrl.CloseSelf = CloseSelf
UITestLaunchAtkCtrl.OpenReadyWindow = OpenReadyWindow
UITestLaunchAtkCtrl.OpenSelectWindow = OpenSelectWindow
UITestLaunchAtkCtrl.OnQuickBattle = OnQuickBattle
UITestLaunchAtkCtrl.SendMopUpRequest = SendMopUpRequest
UITestLaunchAtkCtrl.PlaySectionStory = PlaySectionStory

return UITestLaunchAtkCtrl