---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/13 17:16
---

local UISettingView = BaseClass("UISettingView",UIBaseView);
local this = UISettingView;
local base = UIBaseView;

local function OnLangTypechg(self)
    self:OnLangCreate()

    local player = Game.Scene.Player
    self.NameText.text = player.Nickname
end

local function InitPlayerInfo(self)
    local player = Game.Scene.Player
    local transform = self.playerInfo.transform
    local exp = transform:Find("Exp"):GetComponent("Slider")
    local avatar = transform:Find("iconBg/Icon/Mask/Avatar"):GetComponent("Image")
    exp.value = UIPublic.GetExpValue(player.Level,player.Exp)
    self.LevelText.text = "LV."..player.Level
    self.NameText.text = player.Nickname

    local zPlayerLevel = Z_PlayerLevelUp[player.Level + 1]
    local levelInfo
    if zPlayerLevel == nil then
        levelInfo = "--/--"
    else
        levelInfo = player.Exp.."/"..zPlayerLevel.Exp
    end
    self.ExpValue.text = levelInfo

    self.IDText.text = "ID: " .. player.Id
    local avatarStr = player.Avatar
    UIUtil.SetPlayerIcon(avatar,avatarStr)
end

function this.OnLangCreate(self)
    LangUtil.BindText(self.rc:GetObject("Title").transform:Find("Text")).text = LangUtil.GetSysLang(82)
    LangUtil.BindText(self.rc:GetObject("NameEidt").transform:Find("Text")).text = LangUtil.GetSysLang(351)
    LangUtil.BindText(self.rc:GetObject("IconChangeButton").transform:Find("Text")).text = LangUtil.GetSysLang(344)
    LangUtil.BindText(self.MoreSetButton.transform:Find("Text")).text = LangUtil.GetSysLang(4083)
    LangUtil.BindText(self.LoginButton.transform:Find("Text")).text = LangUtil.GetSysLang(352)
    LangUtil.BindText(self.RedeemCodeButton.transform:Find("Text")).text = LangUtil.GetSysLang(4054)--礼品序列号

    local playerTran = self.playerInfo.transform
    self.LevelText = LangUtil.BindText(playerTran:Find("Exp/Level"))
    self.ExpValue = LangUtil.BindText(playerTran:Find("Exp/Text"))
    self.NameText = LangUtil.BindText(playerTran:Find("iconBg/Name"))
    self.IDText = LangUtil.BindText(playerTran:Find("iconBg/IDBg/Text"))
end

function this.OnCreate(self)
    base.OnCreate(self);
    self.clientData = ClientData:GetInstance()
    self.Mask = self.rc:GetObject("Mask")
    self.Mask:SetActive(false)
    self.playerInfo = self.rc:GetObject("PlayerInfo")

    local func = function()
        UIManager:GetInstance():CloseWindow(UIWindowNames.UISetting)
    end
    UIUtil.AddBtnEvent(self.rc:GetObject("CloseBtn"), func)
    EventTriggerListener.Get(self.rc:GetObject("EventBg")).onLuaClick = func

    UIUtil.AddBtnEvent(self.rc:GetObject("IconChangeButton"),function()
        func()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UISetIcon,{windowNames = {UIWindowNames.UISetting}})
    end)
    UIUtil.AddBtnEvent(self.rc:GetObject("NameEidt"),function()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UINameEdit,{windowNames = {UIWindowNames.UISetting}})
        func()
    end)

    local BtnPanel = self.rc:GetObject("BtnPanel2")

    self.MoreSetButton = BtnPanel.transform:Find("MoreSetButton")
    self.LoginButton = BtnPanel.transform:Find("LoginButton")
    self.RedeemCodeButton = BtnPanel.transform:Find("RedeemCodeButton")
    UIUtil.AddBtnEvent(self.MoreSetButton, function()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIMoreSetting)
    end)
    UIUtil.AddBtnEvent(self.LoginButton, function(go)
        Game.Scene:GetComponent("SoundComponent"):Stop()
        Game.Scene:GetComponent("SessionComponent"):ExitGame(0)
    end)
    UIUtil.AddBtnEvent(self.RedeemCodeButton, function(go)
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIRedeemCode)
    end)

end

function this.OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
end

function OnRefreshCardVolume(self)
    Game.Scene:GetComponent("SoundComponent"):SetCardVolume(self.model.CardVolume)
end

function this.OnRefresh(self)
    InitPlayerInfo(self)
end

function this.OnAddListener(self)
    base.OnAddListener(self);

    self:AddUIListener(UIMessageNames.ON_PLAYER_INFO_CHG,self.OnRefresh)
    self:AddUIListener(UIMessageNames.ON_LANG_TYPE_CHG, OnLangTypechg)
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);

    self:RemoveUIListener(UIMessageNames.ON_PLAYER_INFO_CHG)
    self:RemoveUIListener(UIMessageNames.ON_LANG_TYPE_CHG)
end

function this.OnDisable(self)
    base.OnDisable(self)
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end
return this;
