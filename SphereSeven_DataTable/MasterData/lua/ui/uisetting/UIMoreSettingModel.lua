---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/13 17:16
---

local UIMoreSettingModel = BaseClass("UIMoreSettingModel",UIBaseModel)
local this = UIMoreSettingModel
local base = UIBaseModel

function this.OnCreate(self)
    base.OnCreate(self)
end

function this.OnEnable(self)
    base.OnEnable(self)
    self:OnRefresh()
end

function OnBgmVolumeChg(self)
    local clientData = ClientData:GetInstance()
    self.BgmVolume = clientData.BgmVolume
    self:UIBroadcast(UIMessageNames.UISETTING_ON_BGM_VOLUME_CHG)
end

function OnSoundVolumeChg(self)
    local clientData = ClientData:GetInstance()
    self.SoundVolume = clientData.SoundVolume
    self:UIBroadcast(UIMessageNames.UISETTING_ON_SOUND_VOLUME_CHG)
end

function OnCardVolumeChg(self)
    local clientData = ClientData:GetInstance()
    self.CardVolume = clientData.CardVolume
    self:UIBroadcast(UIMessageNames.UISETTING_ON_CARD_VOLUME_CHG)
end

function this.OnLangTypeChg(self)
    self:UIBroadcast(UIMessageNames.ON_LANG_TYPE_CHG)
end

function this.OnAddListener(self)
    base.OnAddListener(self)
    self:AddDataListener(DataMessageNames.ON_BGM_VOLUME_CHG, OnBgmVolumeChg)
    self:AddDataListener(DataMessageNames.ON_SOUND_VOLUME_CHG, OnSoundVolumeChg)
    self:AddDataListener(DataMessageNames.ON_CARD_VOLUME_CHG, OnCardVolumeChg)
    self:AddDataListener(DataMessageNames.ON_LANG_TYPE_CHG, self.OnLangTypeChg)
end

function this.OnRefresh(self)
    local player = Game.Scene.Player
    local clientData = ClientData:GetInstance()
    self.BgmVolume = clientData.BgmVolume
    self.SoundVolume = clientData.SoundVolume
    self.CardVolume = clientData.CardVolume

    self.isOptEnemySkill = clientData.IsOptEnemySkill
    self.isIgnoreCooldown = clientData.IsIgnoreCooldown

    self.iconData = {}
    local cards = player:GetComponent("CardComponent").Cards
    for k,v in table.pairsByKeys(cards) do
        local zCard = Z_Card[v.TemplateId]
        if self.iconData[zCard.Sphere] == nil then
            self.iconData[zCard.Sphere] = {}
        end
        
        if self.iconData[zCard.Sphere][v.TemplateId] == nil then
            self.iconData[zCard.Sphere][v.TemplateId] = {}
            self.iconData[zCard.Sphere][v.TemplateId].Stage = v.Stage
        else
            local Stage = self.iconData[zCard.Sphere][v.TemplateId].Stage
            self.iconData[zCard.Sphere][v.TemplateId].Stage = (Stage < v.Stage and {v.Stage} or {Stage})[1]
        end
    end

end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self)
    self:RemoveDataListener(DataMessageNames.ON_BGM_VOLUME_CHG, OnBgmVolumeChg)
    self:RemoveDataListener(DataMessageNames.ON_SOUND_VOLUME_CHG, OnSoundVolumeChg)
    self:RemoveDataListener(DataMessageNames.ON_CARD_VOLUME_CHG, OnCardVolumeChg)
    self:RemoveDataListener(DataMessageNames.ON_LANG_TYPE_CHG)
end

function this.OnDisable(self)
    base.OnDisable(self)
end

function this.OnDestroy(self)
    base.OnDestroy(self)
end
return this