---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---

local UIRedeemCodeView = BaseClass("UIRedeemCodeView", UIBaseView);
local base = UIBaseView
local this = UIRedeemCodeView

local function OnClickConfirmButton(self)
    local str = self.input.text
    self.input.text = ""
    if string.IsNullOrEmpty(str) then
        UIUtil.ToolTipFourth(LangUtil.GetSysLang(2191))--输入为空
        return
    end

    coroutine.start(function( )
        PublicRequest.SendRequest(
            PROTOCOL.RedeemGiftCardCodeReq,
            {
                code = str
            },
            function(info, errorCode)              
                if errorCode == 0 then 
                    UIManager:GetInstance():CloseWindow(UIWindowNames.UIRedeemCode)
                    local rewardResult = {}
                    for _, value in pairs(info.reward_result) do
                        table.insert(rewardResult, value)
                    end
                    UIPublic.OpenRewardUI(rewardResult)
                elseif errorCode == 120001 then
                    UIUtil.ToolTipFourth(LangUtil.GetSysLang(2191))
                elseif errorCode == 120002 then
                    UIUtil.ToolTipFourth(LangUtil.GetSysLang(2192))
                elseif errorCode == 120003 then
                    UIUtil.ToolTipFourth(LangUtil.GetSysLang(2193))
                elseif errorCode == 120004 then
                    UIUtil.ToolTipFourth(LangUtil.GetSysLang(2194))
                elseif errorCode == 120005 then
                    UIUtil.ToolTipFourth(LangUtil.GetSysLang(2195))
                else
                    UIUtil.ToolTipFourth(LangUtil.GetSysLang(2191))
                end
            end
        )
    end)

    --if string.utf8len(str) > 10 then
    --    UIUtil.ToolTipFourth(LangUtil.GetSysLang(560))
    --    return
    --end

    -- local tipData = {}
    -- tipData.type = 3
    -- tipData.title = LangUtil.GetSysLang(9)--"提示"
    -- tipData.message = LangUtil.GetSysLang(4057)--确定要进行兑换领取吗？
    -- tipData.callBack = function()
    --     --self.ConfirmButton:GetComponent("Button").enabled = false
    --     coroutine.start(function()
    --         local reqData = {}
    --         reqData.Code = str
    --         reqData.ActorId = 1
    --         local info = coroutine.yieldstart(Game.Scene.Session.CoCall, nil, Game.Scene.Session,
    --                 OuterOpcode.Name2Code.ETModel_C2PF_RedeemCode, reqData)
    --         if info.Error == ErrorCode.ERR_Success then
    --             --self.input.text = ""
    --             UIUtil.ToolTipFourth(LangUtil.GetSysLang(4058))--礼品已发送至邮箱
    --         else
    --             UIUtil.ToolTipFourth(LangUtil.GetServerError(info.Error))
    --         end
    --         --self.ConfirmButton:GetComponent("Button").enabled = true
    --     end)
    -- end

    -- UIUtil.ToolTipFirst(tipData)
end

function this.OnCreate(self)
    base.OnCreate(self);
    self.input = self.rc:GetObject("InputField"):GetComponent("InputField")
    self.ConfirmButton = self.rc:GetObject("ConfirmButton")

    local closefunc = function() UIManager:GetInstance():CloseWindow(UIWindowNames.UIRedeemCode) end
    EventTriggerListener.Get(self.rc:GetObject("EventBg")).onLuaClick = closefunc
    UIUtil.AddBtnEvent(self.rc:GetObject("CloseButton"), closefunc)
    UIUtil.AddBtnEvent(self.rc:GetObject("CancelButton"), closefunc)
    UIUtil.AddBtnEvent(self.ConfirmButton, function() OnClickConfirmButton(self) end)

end

function this.OnLangCreate(self)
    LangUtil.BindText(self.rc:GetObject("ContentText")).text = LangUtil.GetSysLang(4053)--说明
    LangUtil.BindText(self.rc:GetObject("Title").transform:Find("Text")).text = LangUtil.GetSysLang(4054)--礼品序列号
    LangUtil.BindText(self.rc:GetObject("HintText")).text = LangUtil.GetSysLang(4055)--输入礼品序列号

    --LangUtil.BindText(self.rc:GetObject("ConfirmButton").transform:Find("Text")).text = LangUtil.GetSysLang(145)
    --LangUtil.BindText(self.rc:GetObject("CancelButton").transform:Find("Text")).text = LangUtil.GetSysLang(146)
    LangUtil.BindText(self.input.transform:Find("Placeholder"))
    LangUtil.BindText(self.input.transform:Find("Text"):GetComponent("Text"))
end

function this.OnEnable(self)
    base.OnEnable(self);
    self.input.text = ""
    
    self:OnRefresh();
end

function this.OnRefresh(self)

end

function this.OnAddListener(self)
    base.OnAddListener(self)
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self);
    if self.model.data ~= nil and self.model.data.callBack ~= nil then
        self.model.data.callBack()
    end
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;

