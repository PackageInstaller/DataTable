---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/12 21:12
---

---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/12 21:12
---

local UISkinShopCtrl = BaseClass("UISkinShopCtrl",UIBaseCtrl);
local this = UISkinShopCtrl;

function this.CloseSelf(self)
    UIManager:GetInstance():CloseWindow(UIWindowNames.UISkinShop);
    local window =UIManager:GetInstance():GetWindow(UIWindowNames.UIHome)
    local view =window.View
    view:ToolTip()
end

--function this.SendBuyRequest(self,zSkin,FreeStarStone,PaidStarStone)
function this.SendBuyRequest(self, data)
    local reqTable = {
        shop_id = ShowType.CardSkin,
        goods_id = data.StoreId,
        count = 1
    }
    coroutine.start(function()
        PublicRequest.SendRequest(
            PROTOCOL.BuyGoodsReq,
            reqTable,
            function(info, errorCode)
                if errorCode == 202 then
                    UIUtil.ToolTipFourth(LangUtil.GetSysLang(1086))
                    return
                end

                if info ~= nil then 
                    local rewardResult = {}
                    for _, value in pairs(info.reward_result) do
                        if value.type == RewardType.RewardTypeCharacterSkin then
                            table.insert(rewardResult, value)
                        end
                    end
                    UIPublic.OpenRewardUI(rewardResult)
                end
            end
        )
        end)
    -- coroutine.start(function()
    --     local g2cStorePurchase = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
    --             OuterOpcode.Name2Code.ETModel_C2M_BuySkin, { SkinTemplateId = zSkin.Id})
    --     if g2cStorePurchase.Error == ErrorCode.ERR_Success then
    --         local type = zSkin.StorePriceType
    --         local paidStarStone = UIUtil.GetPlayerCurrency(1) - PaidStarStone
    --         local freeStarStone = UIUtil.GetPlayerCurrency(2) - FreeStarStone
    --         UIUtil.SetPlayerCurrency(1,paidStarStone)
    --         UIUtil.SetPlayerCurrency(2,freeStarStone)
    --         local skinInfo = g2cStorePurchase.SkinBean
    --         Game.Scene.Player:GetComponent("SkinComponent"):Add(Game.Registry:NewObject("Skin",skinInfo))
    --         Game.Scene.Player:GetComponent("CardComponent"):InitZCardsSkins()
    --         UIManager:GetInstance():Broadcast(DataMessageNames.ON_SKIN_INFO_CHG,{skinId = skinInfo.TemplateId})
    --         --local func = function()
    --             local infos = {}
    --             table.insert(infos,{rewardType = RewardType.CardSkin,
    --                                 templateId = skinInfo.TemplateId, num = 1})
    --             local info = {rewards = infos, title = LangUtil.GetSysLang(1068)..":"..zSkin.Name.."X1"}
    --             UIManager:GetInstance():OpenWindow(UIWindowNames.UIReward, info)
    --         --end
            
    --         -- 购买皮肤埋点
    --         ChannelManager:GetInstance():BuySkin(zSkin.Id, zSkin.Name)
    --         UIUtil.ToolTipFourth(LangUtil.GetSysLang(1068)..":"..zSkin.Name.."X1");--获得皮肤
    --     else
    --         UIUtil.ToolTipFourth(LangUtil.GetServerError(g2cStorePurchase.Error));
    --     end
    -- end)
end

return this;
