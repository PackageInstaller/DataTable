---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/17 10:02
---

local UITestShopCtrl = BaseClass("UITestShopCtrl",UIBaseCtrl);
local this = UITestShopCtrl;

function this.CloseSelf()
    UIManager:GetInstance():CloseWindow(UIWindowNames.UITestShop);
end

function this.SendBuyItemRequest(self,goods,num)
    local itemComponent = Game.Scene.Player:GetComponent("ItemComponent");
    coroutine.start(function()
        local g2cCardBuyItem = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
                OuterOpcode.Name2Code.ETModel_C2M_BuyItem, { TemplateId = goods.Id,Amount = num });
        if g2cCardBuyItem.Error == ErrorCode.ERR_Success then
            local item = UIPublic.GetItem(goods.Id);
            if item == nil then
                local ItemInfo = g2cCardBuyItem.ItemBean;
                itemComponent:Add(Game.Registry:NewObject("Item", {
                    uid = ItemInfo.ItemId,
                    cid = ItemInfo.TemplateId,
                    count = ItemInfo.Amount
                }))
            else
                item.Amount = g2cCardBuyItem.ItemBean.Amount;
            end
            UIUtil.ToolTipFourth(LangUtil.GetSysLang(223)..Z_Item[goods.Id].Name.."X"..num);
            DataManager:GetInstance():Broadcast(DataMessageNames.ON_ITEM_INFO_CHG);
        end
       
    end)
end

function this.SendBuyCardRequest(self,goods,lv,star)
    local cardComponent = Game.Scene.Player:GetComponent("CardComponent");
    coroutine.start(function()
        local g2cGenerateCard = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
                OuterOpcode.Name2Code.ETModel_C2M_GenerateCard, { TemplateId = goods.TemplateId,Level=lv,Star=star});
        if g2cGenerateCard.Error == ErrorCode.ERR_Success then
           local card = Game.Registry:NewObject("Card",g2cGenerateCard.CardBean);
            card:InitCardComponent()
            cardComponent:Add(card,true);
        end
        
    end)
end

function this.SendBuyEquipRequest(self,zEquip)
    local equipComponent = Game.Scene.Player:GetComponent("EquipComponent");
    local send_data = {};
    send_data.TemplateId = zEquip.Id;
    coroutine.start(function()
        local g2cGenerateEquip = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
                OuterOpcode.Name2Code.ETModel_C2M_GenerateEquip, send_data);
        if g2cGenerateEquip.Error == ErrorCode.ERR_Success then
            local equip = Game.Registry:NewObject("Equip",g2cGenerateEquip.EquipBean);
            equip:AddComponent("EquipAttrComponent");
            equipComponent:Add(equip,true);
            DataManager:GetInstance():Broadcast(DataMessageNames.ON_EQUIP_INFO_CHG);
        end
    end)
end

function this.SendBuyFightSoulRequest(self,zFightSoul)
    local fightSoulComponent = Game.Scene.Player:GetComponent("FightSoulComponent");
    coroutine.start(function()
        local g2cGenerateFightSoul = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
                OuterOpcode.Name2Code.ETModel_C2M_GenerateFightSoul, { TemplateId = zFightSoul.Id});
        if g2cGenerateFightSoul.Error == ErrorCode.ERR_Success then
            DataManager:GetInstance():Broadcast(DataMessageNames.ON_FIGHTSOUL_INFO_CHG);
            UIUtil.ToolTipFourth("--购买:"..Z_FightSoul[zFightSoul.Id].Name.."X1");
        end
    end)
end

return this