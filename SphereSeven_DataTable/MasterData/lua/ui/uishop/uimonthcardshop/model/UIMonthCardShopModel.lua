---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/12 21:12
---

---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/12 21:12
---

---@class UIMonthCardShopModel : UIBaseModel
---@field monthCards MonthCard[]
local UIMonthCardShopModel = BaseClass("UIMonthCardShopModel",UIBaseModel)
local base = UIBaseModel
local this = UIMonthCardShopModel;

function this:OnCreate()
    base.OnCreate(self);
    self.id = -1
end

function this:OnEnable(data)
    base.OnEnable(self)
    ---@type MonthCard[]
    self.monthCards = Game.Scene.Player:GetComponent("MonthCardComponent"):GetMonthCards()
    if data ~= nil then
        self.id = data.id
    end

    if self.id == nil then
        for index, monthCard in ipairs(self.monthCards) do
            if monthCard.expireTime > TimeUtil.GetServerTime() and not monthCard.isReceived then
                self.id = monthCard.id
                break
            end
        end
    end

    if self.id == nil then
        self.id = self.monthCards[1].id
    end
    self:OnRefresh();
end

function this:OnRefresh()

end

local function OnMonthCardInfoChg(self)
    self.monthCards = Game.Scene.Player:GetComponent("MonthCardComponent"):GetMonthCards()
    self:UIBroadcast(UIMessageNames.ON_MONTH_CARD_INFO_CHG);
end

function this.OnAddListener(self)
    base.OnAddListener(self);
    self:AddDataListener(DataMessageNames.ON_MONTH_CARD_INFO_CHG,OnMonthCardInfoChg)
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
    self:RemoveDataListener(DataMessageNames.ON_MONTH_CARD_INFO_CHG)
end

function this.OnDisable(self)
    base.OnDisable(self);
end

function this.OnDestroy(self)
    self.shop_data = nil;
    base.OnDestroy(self);
end

return this

