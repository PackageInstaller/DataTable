---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/10 10:27
---

local UIFungusBgView = BaseClass("UIFungusBgView",UIBaseView);
local base = UIBaseView;
local this = UIFungusBgView;
local fadeDuration = 0.5


local function SetActive(gameObject,_bool)
    if _bool then
        gameObject:GetComponent("Image"):DOFade(0,0)
        gameObject:SetActive(true)
        gameObject:GetComponent("Image"):DOFade(1,0.5)
    else
        gameObject:GetComponent("Image"):DOFade(0,0.5).onComplete = function()  gameObject:SetActive(false) end
    end
end

local function OnFungusBgChg(self,sprite)

    if self.isCreate then
        self.isCreate = false
        local v = self.bgData[1]
        v.bg:GetComponent("Image").sprite = sprite
        v.active = true
       -- v.bg:SetActive(true)
        SetActive(v.bg,true)
    else
        for k,v in pairs(self.bgData) do
            if v.active == false then
                v.bg:GetComponent("Image").sprite = sprite
                --v.bg:SetActive(true)
                SetActive(v.bg,true)
                v.active = true
            else
               -- v.bg:SetActive(false)
                v.active = false
                SetActive(v.bg,false)
            end
        end
    end
    self.button:SetActive(true)
    
end

local function OnClickSkipButton(v)
    Game.Scene:GetComponent("FungusComponent"):StopBlock();
end


function this.OnCreate(self)
    base.OnCreate(self);
    self.text = self.rc:GetObject("Text"):GetComponent("Text");
    self.button = self.rc:GetObject("Button");
    self.bgCtrl = self.rc:GetObject("BgCtrl");
    self.bgData = {{},{}}
    
    self.bgData[1].bg = self.bgCtrl.transform:GetChild(0).gameObject
    self.bgData[1].active = false
    self.bgData[2].bg = self.bgCtrl.transform:GetChild(1).gameObject
    self.bgData[2].active = false

    UIUtil.AddBtnEvent(self.button,function() OnClickSkipButton() end)
    
end

function this.OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
    
end

function this.OnRefresh(self)
    self.button:SetActive(false)
    --SetText(self,self.model.str);
    for k,v in pairs(self.bgData) do
        v.bg:SetActive(false)
        v.active = false
    end

    self.isCreate = true
end

function this.OnAddListener(self)
    base.OnAddListener(self);
    self:AddUIListener(UIMessageNames.ON_FUNGUS_CHG,OnFungusBgChg);
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
    self:RemoveUIListener(UIMessageNames.ON_FUNGUS_CHG);
end

function this.OnDisable(self)
    base.OnDisable(self);
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;