---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/10 14:01
---

local UITestCurrencyCtrl = BaseClass("UITestCurrencyCtrl",UIBaseCtrl);

local this = UITestCurrencyCtrl;

function this.CloseSelf(self)
    UIManager:GetInstance():CloseWindow(UIWindowNames.UITestCurrency)
end

function this.SendRequest(self,data)
    coroutine.start(function()
        local g2cAddCurrency = coroutine.yieldstart(Game.Scene.Session.CoCall, nil,  Game.Scene.Session,
                OuterOpcode.Name2Code.ETModel_C2M_AddCurrency, data);
        if g2cAddCurrency.Error == ErrorCode.ERR_Success then
           
            local player = Game.Scene.Player;
            local count = data.CurrencyCount;
            local func_tab = {
                [0] = function() player.GoldCoin = player.GoldCoin + count end ,
                [1] = function() player.PaidStarStone = player.PaidStarStone + count end ,
                [2] = function() player.FreeStarStone = player.FreeStarStone + count end ,
                [3] = function() player.StarSand = player.StarSand + count end ,
                [4] = function() player.MagicCrystal = player.MagicCrystal + count end ,
                [5] = function() player.EmperorStarPoint = player.EmperorStarPoint + count end ,
                [6] = function() player.PaidStarStone = player.PaidStarStone + count end
            }
            func_tab[data.CurrencyTypeVal]();
            local str_tab = {[0] = Z_Currency[1].Name,[1] = Z_Currency[2].Name,[2] = Z_Currency[3].Name,[3] = Z_Currency[4].Name,
                             [4] = Z_Currency[5].Name,[5] = Z_Currency[6].Name,[6] = Z_Currency[2].Name};
            UIUtil.ToolTipFourth("--获得:"..count..str_tab[data.CurrencyTypeVal]);
            DataManager:GetInstance():Broadcast(DataMessageNames.ON_PLAYER_INFO_CHG);
        end
    end)
end

return this;