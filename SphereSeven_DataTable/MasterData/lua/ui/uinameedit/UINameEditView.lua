---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/5/24 16:58
---
---@class UINameEditView : UIBaseView
---@field ctrl UINameEditCtrl
---@field model UINameEditModel
local UINameEditView = BaseClass("UINameEditView",UIBaseView);
local base = UIBaseView
local this = UINameEditView

local function OpenDataWindows(self)
    if self.model.data ~= nil and self.model.data.windowNames ~= nil then
        for k,v in pairs(self.model.data.windowNames) do
            UIManager:GetInstance():OpenWindow(v)
        end
    end
end

---@param self UINameEditView
local function OnClickConfirmButton(self)
    local str = self.input.text
    self.input.text = ""
    if string.IsNullOrEmpty(str) then
        UIUtil.ToolTipFourth(LangUtil.GetSysLang(559))
        return
    end

    if string.utf8len(str) > 8 then
        UIUtil.ToolTipFourth(LangUtil.GetSysLang(560))
        return
    end

    local tbResults = LibStringSearch:IsContains(str)
    if tbResults then
        UIUtil.ToolTipFourth(LangUtil.GetSysLang(866))
        return
    end

    -- local tipData ={}
    -- tipData.type = 1
    -- tipData.TemplateId = 3026
    -- local item = table.first(Game.Scene.Player:GetComponent("ItemComponent").Items, function(v) return v.TemplateId == tipData.TemplateId end) 
    -- local num = (item~=nil and {item.Amount} or {0})[1]
    -- -- if num > 0 then
    --     tipData.title = LangUtil.GetSysLang(9)--"提示"
    --     tipData.message = LangUtil.GetSysLang(743)--"确定消费「空白の名札」改名?"
    --     tipData.ExpenseNum = 1 --需要消耗一张
    --     tipData.Amount = num
    --     tipData.But2 = function()
            self.ctrl:SendChangeNameRequest(str)
        --     if  item ~= nil  then
        --         coroutine.start(function()
        --             local reqData={}
        --             reqData.Name=str
        --             reqData.ItemId = 1 --使用空白名片
        --             local info = coroutine.yieldstart(Game.Scene.Session.CoCall,nil,Game.Scene.Session,
        --                     OuterOpcode.Name2Code.ETModel_C2M_SetPlayerName, reqData)
        --             if info.Error == ErrorCode.ERR_Success then
        --                 Game.Scene.Player.Nickname = str
        --                 DataManager:GetInstance():Broadcast(DataMessageNames.ON_PLAYER_INFO_CHG)
        --                 UIManager:GetInstance():CloseWindow(UIWindowNames.UINameEdit)
        --                 OpenDataWindows(self)
        --                 UIUtil.RemoveItem(item.Id,1)
        --                 UIUtil.ToolTipFourth(LangUtil.GetSysLang(563))
        --             else
        --                 UIUtil.ToolTipFourth(LangUtil.GetServerError(info.Error))
        --             end
        --         end)
        --    else
        --         UIManager:GetInstance():CloseWindow(UIWindowNames.UINameEdit)
        --     end
        -- end
    -- else
    --     tipData.title = LangUtil.GetSysLang(9)--"提示"
    --     tipData.message = LangUtil.GetSysLang(744)--"没有空白の名札」，前往商店购买？"
    --     tipData.notNum = true --不显示数量
    --     tipData.But2 = function()
    --         local general_data ={}
    --         general_data.TemplateId = 3026
    --         general_data.windowNames ={UIWindowNames.UINameEdit}--商店退出打开改名ui
    --         UIManager:GetInstance():CloseWindow(UIWindowNames.UINameEdit)
    --         UIManager:GetInstance():OpenWindow(UIWindowNames.UIGeneralShop, general_data)
    --     end
    -- end

    -- UIUtil.ToolTipEight(tipData)
    --UIUtil.ToolTipFirstPlus(tipData)
    --local item = table.first(Game.Scene.Player:GetComponent("ItemComponent").Items,function(v) return v.TemplateId == 3026 end)
    --tipData.Amount = (item~=nil and {item.Amount} or {0})[1]
    
end

function this.OnCreate(self)
    base.OnCreate(self);

    self.input = self.rc:GetObject("InputField"):GetComponent("InputField")
    local func = function()
        UIManager:GetInstance():CloseWindow(UIWindowNames.UINameEdit)
        OpenDataWindows(self)
    end
    -- self.NeedFrame = self.rc:GetObject("NeedFrame").transform

    EventTriggerListener.Get(self.rc:GetObject("EventBg")).onLuaClick = func
    UIUtil.AddBtnEvent(self.rc:GetObject("CloseButton"), func)
    UIUtil.AddBtnEvent(self.rc:GetObject("CancelButton"), func)
    UIUtil.AddBtnEvent(self.rc:GetObject("ConfirmButton"),function() OnClickConfirmButton(self) end)
    
end
function this.OnLangCreate(self)
    LangUtil.BindText(self.rc:GetObject("Frame").transform:Find("Text"))

    -- LangUtil.BindText(self.NeedFrame:Find("Txt")).text = LangUtil.GetSysLang(802)
    -- self.itemNum = LangUtil.BindText(self.NeedFrame:Find("Num"))
    
    LangUtil.BindText(self.rc:GetObject("HintText")).text = LangUtil.GetSysLang(815)
    LangUtil.BindText(self.rc:GetObject("ConfirmButton").transform:Find("Text")).text = LangUtil.GetSysLang(145)
    LangUtil.BindText(self.rc:GetObject("CancelButton").transform:Find("Text")).text = LangUtil.GetSysLang(146)
    LangUtil.BindText(self.input.transform:Find("Placeholder"))
    local inputText = self.input.transform:Find("Text"):GetComponent("Text")
    LangUtil.BindText(inputText)
end

function this.OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
end

function this.OnRefresh(self) 
    self.input.text = ""
    
    -- local zItem = Z_Item[3026]
    -- local num = UIPublic.GetItemAmount(zItem.Id)
    -- local needTxtcolor = ( num >= 1 and {"<color=#AAD2FF>"} or {"<color=#F0274D>"})[1]
    -- self.itemNum.text = needTxtcolor .. num  .. "</color>"
end

function this.OnAddListener(self)
    base.OnAddListener(self)
end

function this.OnRemoveListener(self)
    base.OnRemoveListener(self);
end

function this.OnDisable(self)
    base.OnDisable(self);
    if self.model.data ~= nil and self.model.data.callBack ~= nil then
        self.model.data.callBack()
    end
end

function this.OnDestroy(self)
    base.OnDestroy(self);
end

return this;

