---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2019/4/8 21:10
---
local UISelectView = BaseClass("UISelectView",UIBaseView );
local base = UIBaseView ;

local button_btn_prefab_path = "Button";
local title_text_path = "Text";
local content_path = "Content";


local function OnCreate(self)
     base.OnCreate(self);
     local rc = self.gameObject:GetComponent(typeof(CS.ReferenceCollector));
     self.button_btn_prefab = rc:GetObject(button_btn_prefab_path);
     self.title_text = rc:GetObject(title_text_path):GetComponent("Text");
     self.content = rc:GetObject(content_path);
     EventTriggerListener.Get(self.gameObject).onLuaClick = self.ctrl.CloseSelf;
end

local function OnEnable(self)
    base.OnEnable(self);
    self:OnRefresh();
end

local function OnClickButton(gameObject)
    local data = gameObject:GetComponent("BindData"):Get("data");
    local self = gameObject:GetComponent("BindData"):Get("self");
    self.ctrl:OnSelect(data.func)
end

local function InitButton(gameObject)
    local transform = gameObject.transform;
    local text = transform:Find("Text"):GetComponent("Text");
    
    local data = gameObject:GetComponent("BindData"):Get("data");
    
    text.text = data.name;
    if data.isMeet then
        gameObject:GetComponent("Image").color = Color.New(1,1,1);
        gameObject:GetComponent("Button").enabled = true;
        ButtonListener.Get(gameObject).OnClickHandler = OnClickButton;
    else
        gameObject:GetComponent("Image").color = Color.New(0.5,0.5,0.5);
        gameObject:GetComponent("Button").enabled = false;
    end
       

end

local function OnRefresh(self)
    
    self.title_text.text = self.model.data.title;
    ListChildPool:GetInstance():ClearContent(self.content);
    coroutine.start(function()
        for i = 1,#self.model.data do
            ListChildPool:GetInstance():GetChild(self.button_btn_prefab,self.content,function(object)
                local bindData = UIUtil.GetButtonDataComponent(object);
                bindData:Add("data",self.model.data[i]);
                bindData:Add("self",self);
                InitButton(object);
            end);
        end
        
    end)
end

local function OnAddListener(self)
    base.OnAddListener(self);
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self);
end

local function OnDestroy(self)
    self.button_btn_prefa = nil;
    self.title_text = nil;
    self.content = nil;
    base.OnDestroy(self);
end

UISelectView.OnCreate = OnCreate
UISelectView.OnEnable = OnEnable
UISelectView.OnRefresh = OnRefresh
UISelectView.OnAddListener = OnAddListener
UISelectView.OnRemoveListener = OnRemoveListener
UISelectView.OnDestroy = OnDestroy

return UISelectView

